/* ==========================================================================
   Desktop / Tablet Responsive Dashboard Layout (Premium 4-Column Design)
   Active on screens wider than 1280px.
   Layout: [ Play (Main) ] | [ Chat ] | [ Playlist ] | [ Settings ]
   ========================================================================== */

@media (min-width: 1280px) {

    /* ---------------------------------------------------
       1. Application Base Grid
       --------------------------------------------------- */
    body {
        display: grid;
        grid-template-columns: 1fr 420px 420px;
        grid-template-rows: var(--header-height) 1fr 1fr;
        grid-template-areas:
            "header header header"
            "tab-play tab-playlist tab-settings"
            "tab-play tab-chat tab-settings";
        gap: 0;
        /* Gaps emulated through panel paddings so vertical dividers function cleanly */
        padding-bottom: 0;
        padding-right: 24px;
        padding-left: 24px;
        background: var(--bg);
        /* Deepest background for the outer space */
        overflow: hidden;
        height: 100vh;
    }

    header {
        grid-area: header;
        position: relative;
        width: 100vw;
        margin-left: -24px;
        /* Offset the body's padding-left */
        padding-left: 24px !important;
        padding-right: 24px !important;
        box-sizing: border-box;
        box-shadow: none;
        background: var(--glass-bg);
        border-bottom: none !important;
        /* Seamless header */
        margin-bottom: 0;
        /* Stopped underlap */
    }

    /* ---------------------------------------------------
       2. Hide Mobile Elements
       --------------------------------------------------- */
    .bottom-nav,
    .nav-blur-halo,
    .bottom-nav::before {
        display: none !important;
    }

    #btn-chat-close,
    #chat-preview-btn {
        display: none !important;
    }

    .chat-drawer-backdrop {
        display: none !important;
    }

    /* ---------------------------------------------------
       3. Shared Panel Styles
       --------------------------------------------------- */
    #tab-play,
    .chat-drawer,
    #tab-playlist,
    #tab-settings,
    #tab-guide {
        padding-top: 0 !important;
        /* Panels have internal headers now */
        display: flex !important;
        flex-direction: column !important;
        /* Vertical column layout */
        opacity: 1 !important;
        visibility: visible !important;
        pointer-events: auto !important;
        position: relative !important;
        transform: none !important;
        height: 100% !important;
        top: 0 !important;
        left: 0 !important;
        width: 100% !important;

        background: transparent !important;
        border-radius: 0;
        border: none;
        box-shadow: none !important;
        /* Reset any shadows from mobile styles */
        overflow: hidden !important;
        /* Parent NO LONGER scrolls */
    }

    /* New Scrolling Architecture: Bodies handle the scroll */
    .tab-body,
    .chat-drawer-messages {
        flex: 1 !important;
        overflow-y: auto !important;
        padding-bottom: 40px !important;
        scrollbar-gutter: stable;
        /* Prevent layout shift */
    }

    /* tab-play is special as it doesn't use tab-body yet, it still scrolls the parent for now or we can fix it too */
    #tab-play {
        overflow-y: auto !important;
    }

    /* Panel Headers: Fixed at the top, No Background Mask needed anymore! */
    .tab-header,
    .chat-drawer-header {
        flex: none !important;
        padding: 32px 32px 16px !important;
        position: relative !important;
        /* No longer sticky */
        background: transparent !important;
        /* Masking box REMOVED */
        z-index: 10;
        border-bottom: none !important;
        margin-bottom: 0;
    }

    /* Harmonize Header Typographies (Title, Menu, Chat, etc) */
    .tab-title,
    .chat-drawer-title,
    .track-title {
        font-size: 24px !important;
        /* Beautifully unified and properly proportioned */
        font-weight: 800 !important;
        letter-spacing: -0.02em !important;
        color: var(--text-main) !important;
    }

    /* ---------------------------------------------------
       4. Specific Panel: Play (Main)
       --------------------------------------------------- */
    /* Elegant vertical dividers via standard border */
    #tab-play {
        padding: 0 0 0 8px !important;
        /* 다시 물리적인 8px 대칭(수학적 정렬)으로 원복 */
        border-right: 1px solid var(--surface-3) !important;
        min-width: 0 !important;
        min-height: 0 !important;
        max-width: 100% !important;
    }

    #tab-playlist {
        padding: 0 0 0 8px !important;
        border-right: 1px solid var(--surface-3) !important;
        border-bottom: 1px solid var(--surface-3) !important;
    }

    .chat-drawer {
        padding: 0 !important;
        /* 채팅창은 다른 패널과 달리 전체가 아닌 중간 영역(.chat-drawer-messages)만 스크롤되므로 껍데기 마진 0 */
        border-right: 1px solid var(--surface-3) !important;
        background: transparent !important;
        box-shadow: none !important;
    }

    #tab-settings {
        padding: 0 0 0 8px !important;
    }

    .play-header-desktop {
        display: none !important;
        /* Hide "Main" header on PC as requested */
    }

    #tab-play {
        grid-area: tab-play;
        flex-direction: column;
        justify-content: flex-start !important;
        align-items: center;
        padding-top: 70px !important;
        padding-bottom: 20px !important;
        gap: 16px;
        /* Tighter gap for compact vertical fit */
        overflow-y: auto;
        overflow-x: hidden;
    }

    .play-action-buttons {
        position: relative !important;
        bottom: auto;
        left: auto;
        right: auto;
        width: 100% !important;
        max-width: calc(100% - 80px);
        margin-left: auto;
        margin-right: auto;
        gap: 12px !important;
        margin-top: auto;
        /* Pushes to bottom of flex column naturally */
        padding-bottom: 0px;
        flex-shrink: 0;
        justify-content: center;
    }

    .play-action-buttons .file-select-btn-large {
        padding: 24px 20px !important;
        font-size: 16px !important;
    }

    .vinyl-wrapper {
        width: clamp(200px, 18vw, 320px);
        height: clamp(200px, 18vw, 320px);
        margin-bottom: 40px;
        /* Breathes properly */
    }

    .video-wrapper {
        width: 100%;
        /* Prevent infinite scaling on wide monitors, also respect vertical space for controls */
        max-width: min(90%, 1080px, calc((100vh - 360px) * 16 / 9));
        margin: 0 auto 30px auto;
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
    }

    /* Play Controller adjustments */
    .controls-area {
        max-width: 100%;
        padding: 0 32px;
        margin-top: 8px;
        flex-grow: 1;
        /* Pushes action buttons to the bottom */
        /* Tighter spacing between title and controls */
    }

    /* ---------------------------------------------------
       5. Specific Panel: Chat
       --------------------------------------------------- */
    .chat-drawer {
        grid-area: tab-chat;
    }

    /* ---------------------------------------------------
       6. Specific Panel: Playlist
       --------------------------------------------------- */
    #tab-playlist {
        grid-area: tab-playlist;
    }

    /* ---------------------------------------------------
       7. Specific Panel: Settings
       --------------------------------------------------- */
    #tab-settings {
        grid-area: tab-settings;
        /* Padding bottom is handled by .tab-content style above */
    }

    /* ---------------------------------------------------
       8. Guide (도움말 화면)
       --------------------------------------------------- */
    #tab-guide {
        display: none !important;
    }

    /* ---------------------------------------------------
       9. Setup/Onboarding Overlay — Full-Width 2-Column Desktop Layout
       --------------------------------------------------- */
    #setup-overlay {
        position: fixed;
        inset: 0;
        z-index: 5000;
        background: var(--bg) !important;
        backdrop-filter: none;
        -webkit-backdrop-filter: none;
    }

    #setup-overlay .setup-card.full-screen {
        position: fixed;
        inset: 0;
        width: 100vw !important;
        max-width: none !important;
        height: 100vh !important;
        max-height: none !important;
        border-radius: 0;
        border: none !important;
        outline: none !important;
        box-shadow: none;
        background: transparent !important;
        padding: 0 !important;
        transform: none;
        display: grid;
        grid-template-columns: 1fr 480px;
        grid-template-rows: 1fr;
        overflow: hidden;
    }

    /* --- Left Column: Diagram area + step header --- */
    #setup-desktop-brand {
        display: flex !important;
        flex: 1;
        background: var(--bg) !important;
        flex-direction: column;
        justify-content: flex-start;
        align-items: flex-start;
        text-align: left;
        padding: 0;
        color: white;
        position: relative;
        overflow: hidden;
    }

    /* Hide the static brand logo/tagline — replaced by dynamic step headers */
    #setup-desktop-brand .brand-content {
        display: none !important;
    }

    /* --- Desktop step header (mirrored into left panel by JS) --- */
    .desktop-step-header {
        display: block !important;
        padding: clamp(48px, 7vh, 80px) clamp(48px, 5vw, 80px) 0;
        width: 100%;
        z-index: 2;
    }

    .desktop-step-header h2 {
        font-size: clamp(22px, 2.4vw, 32px) !important;
        font-weight: 800;
        letter-spacing: -0.03em;
        color: var(--text-main);
        margin-bottom: 8px;
        line-height: 1.2;
    }

    .desktop-step-header p {
        font-size: clamp(13px, 1.1vw, 16px) !important;
        color: var(--text-sub);
        opacity: 0.55;
        line-height: 1.5;
    }

    /* --- Desktop diagram area (elements moved here by JS) --- */
    .desktop-diagram-area {
        display: flex !important;
        flex: 1;
        width: 100%;
        align-items: center;
        justify-content: center;
        padding: clamp(16px, 3vh, 40px) clamp(40px, 6vw, 100px);
        position: relative;
        overflow: visible;
    }

    /* --- Hide headers from the right panel (they're now mirrored to the left) --- */
    #setup-overlay .setup-mobile-view .setup-header-text {
        display: none !important;
    }

    /* --- Right Column: Interactive panel (vertically centered content) --- */
    #setup-overlay .setup-mobile-view {
        width: 480px;
        min-width: 480px;
        background: var(--surface-1);
        height: 100%;
        box-shadow: none;
        border-left: 1px solid rgba(255, 255, 255, 0.06);
        padding: 0 !important;
        overflow-y: auto !important;
        scrollbar-gutter: stable;
        -ms-overflow-style: auto;
        display: flex !important;
        flex-direction: column;
        justify-content: center;
    }

    #setup-overlay .setup-mobile-view::-webkit-scrollbar {
        width: 8px;
        height: 8px;
    }

    #setup-overlay .setup-mobile-view::-webkit-scrollbar-track {
        margin-top: 20px;
        margin-bottom: 20px;
        background: transparent;
    }

    #setup-overlay .setup-mobile-view::-webkit-scrollbar-thumb {
        background-color: rgba(255, 255, 255, 0.15);
        border: 2px solid transparent;
        border-radius: 10px;
        background-clip: padding-box;
    }

    #setup-overlay .setup-mobile-view::-webkit-scrollbar-thumb:hover {
        background-color: rgba(255, 255, 255, 0.35);
    }

    #setup-overlay .setup-mobile-view::-webkit-scrollbar-thumb:active {
        background-color: rgba(255, 255, 255, 0.55);
    }

    /* --- Onboarding slider: enlarged when inside left panel --- */
    .desktop-diagram-area #ob-slider-area {
        width: 100% !important;
        display: flex !important;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }

    .desktop-diagram-area .ob-slider-viewport {
        width: clamp(320px, 60%, 560px);
    }

    .desktop-diagram-area .ob-dots {
        margin-top: 32px;
    }

    /* Enlarge onboarding icon circles for desktop */
    .desktop-diagram-area .ob-icon-circle {
        width: clamp(72px, 8vw, 100px);
        height: clamp(72px, 8vw, 100px);
    }

    .desktop-diagram-area .ob-icon-circle svg {
        width: clamp(32px, 3.5vw, 44px);
        height: clamp(32px, 3.5vw, 44px);
    }

    .desktop-diagram-area .ob-slide .ob-title {
        font-size: clamp(22px, 2.2vw, 28px);
    }

    .desktop-diagram-area .ob-slide .ob-desc {
        font-size: clamp(13px, 1.1vw, 15px);
    }

    /* Onboarding arrows */
    .desktop-diagram-area .ob-arrow-left {
        left: calc(50% - clamp(160px, 30%, 280px) - 52px);
    }

    .desktop-diagram-area .ob-arrow-right {
        right: calc(50% - clamp(160px, 30%, 280px) - 52px);
    }

    /* --- Role SVG diagram: enlarged in left panel --- */
    .desktop-diagram-area .setup-graphic-container {
        width: 100% !important;
        max-width: none !important;
        max-height: none !important;
        height: auto !important;
        min-height: 0 !important;
        margin: 0 !important;
        display: flex !important;
        align-items: center;
        justify-content: center;
    }

    .desktop-diagram-area .setup-graphic-svg {
        max-width: clamp(480px, 60vw, 780px) !important;
        width: 100% !important;
        height: auto !important;
    }

    /* --- Network guide diagrams: enlarged in left panel --- */
    .desktop-diagram-area .setup-guide-unified {
        width: 100% !important;
        display: flex !important;
        flex-direction: column;
        align-items: center;
        gap: clamp(40px, 6vh, 72px);
        margin: 0 !important;
    }

    .desktop-diagram-area .setup-guide-unified .setup-graphic-svg {
        max-width: clamp(420px, 55vw, 680px) !important;
        height: clamp(100px, 16vh, 200px) !important;
    }

    .desktop-diagram-area .setup-unified-item .setup-inner-desc {
        font-size: clamp(14px, 1.3vw, 18px);
    }

    /* --- Actions bar pinned to bottom of right column --- */
    #setup-overlay .setup-mobile-view .ob-actions {
        background: var(--surface-1) !important;
        padding-left: 40px !important;
        padding-right: 40px !important;
        padding-bottom: 40px !important;
        padding-top: 16px !important;
        border-top: none;
        margin-top: auto;
        flex-shrink: 0;
    }

    /* --- Right panel content areas: center vertically when visible --- */
    /* NOTE: These areas use inline style display:none/flex toggled by JS.
       We must NOT use display:flex !important here or it overrides JS hiding.
       Use flex properties only - they'll apply when JS sets display:flex. */
    #setup-overlay #setup-welcome-area,
    #setup-overlay #setup-code-area,
    #setup-overlay #setup-join-area,
    #setup-overlay #setup-role-area {
        flex: 1;
        flex-direction: column;
        justify-content: center;
        align-items: stretch;
    }

    /* --- Content padding inside right panel --- */
    .setup-mobile-view>div:not(.ob-actions, .setup-header-pill) {
        padding-left: 40px !important;
        padding-right: 40px !important;
    }

    /* Map media/youtube overlays into the main Play grid area instead of full-screen popups */
    #media-source-overlay,
    #youtube-url-overlay {
        position: relative !important;
        grid-area: tab-play;
        z-index: 5000;
        background: var(--bg) !important;
        backdrop-filter: none !important;
        -webkit-backdrop-filter: none !important;
        border-right: 1px solid var(--surface-3);
        padding: 0 !important;
        border-radius: 0;
        overflow-x: hidden !important;
        overflow-y: scroll !important;
        scrollbar-gutter: stable;
        -ms-overflow-style: auto;
        display: none !important;
        height: 100% !important;
        max-height: 100% !important;
        min-height: 0 !important;
        min-width: 0 !important;
        width: 100% !important;
        max-width: 100% !important;
        box-sizing: border-box !important;
        inset: auto !important;
    }

    #media-source-overlay.active,
    #youtube-url-overlay.active {
        display: flex !important;
        flex-direction: column;
    }

    #media-source-overlay::-webkit-scrollbar,
    #youtube-url-overlay::-webkit-scrollbar {
        width: 8px;
        height: 8px;
    }

    #media-source-overlay::-webkit-scrollbar-track,
    #youtube-url-overlay::-webkit-scrollbar-track {
        margin-top: 20px;
        margin-bottom: 20px;
        background: transparent;
    }

    #media-source-overlay::-webkit-scrollbar-thumb,
    #youtube-url-overlay::-webkit-scrollbar-thumb {
        background-color: rgba(255, 255, 255, 0.15);
        border: 2px solid transparent;
        border-radius: 10px;
        background-clip: padding-box;
    }

    #media-source-overlay::-webkit-scrollbar-thumb:hover,
    #youtube-url-overlay::-webkit-scrollbar-thumb:hover {
        background-color: rgba(255, 255, 255, 0.35);
    }

    #media-source-overlay::-webkit-scrollbar-thumb:active,
    #youtube-url-overlay::-webkit-scrollbar-thumb:active {
        background-color: rgba(255, 255, 255, 0.55);
    }

    #media-source-overlay .setup-card.full-screen,
    #youtube-url-overlay .setup-card.full-screen {
        position: relative !important;
        top: 0 !important;
        left: 0 !important;
        transform: none !important;
        width: 100% !important;
        height: auto !important;
        min-height: 100% !important;
        max-height: none !important;
        border-radius: 0 !important;
        border: none !important;
        box-shadow: none !important;
        background: transparent !important;
        padding: 40px 0 0 0 !important;
        display: flex;
        flex-direction: column;
    }

    /* Prevent horizontal overflow from mobile inline CSS hacks */
    #setup-role-area .setup-graphic-container {
        margin-left: 0 !important;
        margin-right: 0 !important;
        width: 100% !important;
    }

    /* Wrap contents nicely and prevent them from shrinking weirdly */
    .setup-card.full-screen>* {
        flex-shrink: 0;
    }

    /* Padding for inner content (media/youtube overlays) */
    #media-source-overlay .setup-card.full-screen>div:not(.ob-actions),
    #youtube-url-overlay .setup-card.full-screen>div:not(.ob-actions) {
        padding-left: 40px !important;
        padding-right: 40px !important;
    }

    /* Override the mobile-specific padding dynamically but keep top/bottom */
    #media-source-overlay .setup-card.full-screen .ob-actions,
    #youtube-url-overlay .setup-card.full-screen .ob-actions {
        background: transparent !important;
        padding-left: 40px !important;
        padding-right: 40px !important;
        padding-bottom: 40px !important;
    }

    /* Tab text switching (Desktop) */
    .nav-text-desktop {
        display: inline !important;
    }

    .nav-text-mobile {
        display: none !important;
    }

    .desktop-help-section {
        display: block !important;
        margin-top: 32px !important;
    }

    button[data-tab="guide"] {
        display: none !important;
    }

    /* Completely Flatten Layout for Desktop (No boxes, no dividers) */
    .section-group {
        background: transparent !important;
        margin: 0 12px !important;
        box-shadow: none !important;
        border: none !important;
        border-radius: 0 !important;
        border-bottom: 1px solid var(--surface-3) !important;
    }

    #tab-settings .channel-grid {
        padding: 12px 20px 12px !important;
        /* Standardized for desktop */
    }

    .section-header-row {
        border-bottom: none !important;
        padding: 44px 20px 16px !important;
        /* Symmetric 44px top start and 28px gap to content */
    }

    /* Role Selection: Match the default 44px top padding of other sections */
    #youtube-settings-disabled-wrap .section-group:first-of-type .section-header-row {
        padding-top: 44px !important;
    }

    .section-title {
        font-size: 17px !important;
        font-weight: 700 !important;
        color: var(--text-main) !important;
        text-transform: none !important;
        /* Remove uppercase if it was applied */
        letter-spacing: normal !important;
    }

    .slider-wrap {
        padding: 6px 20px !important;
    }

    /* Enforce 44px bottom gap on desktop too */
    .section-group>*:last-child {
        padding-bottom: 44px !important;
    }

    /* Align theme pill with section title on desktop */
    .theme-selector {
        margin-left: 20px !important;
        margin-right: 20px !important;
    }

    /* Align language pill with section title on desktop */
    .lang-selector {
        margin-left: 20px !important;
        margin-right: 20px !important;
    }

    /* Soften the settings text so title stands out */
    .slider-header {
        font-weight: 500 !important;
        color: var(--text-sub) !important;
        margin-bottom: 8px !important;
        /* Bring text closer to its own slider line */
    }

    .slider-header>span {
        color: var(--text-sub) !important;
    }

    .slider-header .val-disp {
        font-weight: 700 !important;
        color: var(--primary) !important;
    }

    .help-block {
        background: transparent !important;
        margin: 0 16px 16px !important;
        /* Match section-group width */
        padding: 16px !important;
        /* Aligns nicely with settings items */
        border: none !important;
        box-shadow: none !important;
    }

    .playlist-ul {
        margin: 0 16px !important;
    }

    /* Restore scrollbars for desktop bodies */
    .tab-body {
        -ms-overflow-style: auto !important;
        overflow-y: scroll !important;
        scrollbar-gutter: stable;
    }

    .tab-body::-webkit-scrollbar {
        width: 8px;
        height: 8px;
    }

    .tab-body::-webkit-scrollbar-track {
        margin-top: 10px;
        /* Reduced from 86px since it's now inside the body */
        margin-bottom: 20px;
        background: transparent;
    }

    .tab-body::-webkit-scrollbar-thumb {
        background-color: rgba(255, 255, 255, 0.15);
        border: 2px solid transparent;
        border-radius: 10px;
        background-clip: padding-box;
    }

    .tab-body::-webkit-scrollbar-thumb:hover {
        background-color: rgba(255, 255, 255, 0.35);
    }

    .tab-body::-webkit-scrollbar-thumb:active {
        background-color: rgba(255, 255, 255, 0.55);
    }

    /* Apply the exact same floaty scrollbar and layout-shift prevention to the Chat panel on Desktop, but without the 86px track margin because its header is outside the scroll area */
    .chat-drawer-messages {
        -ms-overflow-style: auto !important;
        overflow-y: scroll !important;
        scrollbar-gutter: stable;
        padding-left: 24px !important;
        /* 기본 여백 16px + 우측 투명 스크롤바 대칭용 물리적 여백 8px 추가 */
    }

    .chat-drawer-messages::-webkit-scrollbar {
        width: 8px;
        height: 8px;
    }

    .chat-drawer-messages::-webkit-scrollbar-track {
        margin-bottom: 20px;
        background: transparent;
    }

    .chat-drawer-messages::-webkit-scrollbar-thumb {
        background-color: rgba(255, 255, 255, 0.15);
        border: 2px solid transparent;
        border-radius: 10px;
        background-clip: padding-box;
    }

    .chat-drawer-messages::-webkit-scrollbar-thumb:hover {
        background-color: rgba(255, 255, 255, 0.35);
    }

    .chat-drawer-messages::-webkit-scrollbar-thumb:active {
        background-color: rgba(255, 255, 255, 0.55);
    }

    /* Light mode: dark scrollbar thumbs on light background */
    [data-theme="light"] .tab-body::-webkit-scrollbar-thumb {
        background-color: rgba(0, 0, 0, 0.2);
    }

    [data-theme="light"] .tab-body::-webkit-scrollbar-thumb:hover {
        background-color: rgba(0, 0, 0, 0.4);
    }

    [data-theme="light"] .tab-body::-webkit-scrollbar-thumb:active {
        background-color: rgba(0, 0, 0, 0.6);
    }

    [data-theme="light"] .chat-drawer-messages::-webkit-scrollbar-thumb {
        background-color: rgba(0, 0, 0, 0.2);
    }

    [data-theme="light"] .chat-drawer-messages::-webkit-scrollbar-thumb:hover {
        background-color: rgba(0, 0, 0, 0.4);
    }

    [data-theme="light"] .chat-drawer-messages::-webkit-scrollbar-thumb:active {
        background-color: rgba(0, 0, 0, 0.6);
    }

    .track-item {
        border-bottom: none !important;
    }

    .chat-drawer-input {
        background: transparent !important;
    }

    /* Keep the action buttons consistently sized on all desktop viewports rather than full-width */
    .play-action-buttons {
        justify-content: center;
    }

    .play-action-buttons .file-select-btn {
        height: 60px;
        width: 160px !important;
        min-width: 160px !important;
        padding: 0 16px;
        border-radius: 20px;
        flex: none !important;
        /* Defeat inline style flex:1 from html */
        justify-content: center;
        align-items: center;
    }

    /* Bring back the text and align it nicely next to the icon */
    .play-action-buttons span {
        display: block !important;
        font-size: 14px;
        font-weight: 700;
    }

    /* Size the SVG icon correctly */
    .play-action-buttons .file-select-btn svg {
        width: 22px;
        height: 22px;
        margin: 0;
        margin-right: 8px;
        fill: var(--text-main);
    }
}