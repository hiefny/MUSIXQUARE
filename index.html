<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
    <!-- Android: remove viewport-fit=cover immediately (before first paint)
         to prevent the viewport extending behind the system navigation bar.
         This MUST run synchronously in <head> to avoid reflow. -->
    <script>
        // Android: remove viewport-fit=cover immediately (before first paint).
        // Some Android tablets/WebViews can extend the viewport behind the
        // system navigation bar when viewport-fit=cover is present, which
        // keeps bottom content clipped.
        if (/Android/i.test(navigator.userAgent)) {
            var m = document.querySelector('meta[name="viewport"]');
            if (m) {
                var c = m.getAttribute('content') || '';
                // Remove regardless of formatting: ", viewport-fit=cover" or "viewport-fit=cover".
                c = c.replace(/(?:,?\s*)viewport-fit=cover/g, '');
                // Cleanup possible trailing commas/spaces.
                c = c.replace(/,\s*,/g, ',').replace(/,\s*$/g, '').trim();
                m.setAttribute('content', c);
            }
        }
    </script>

    <meta name="color-scheme" content="light dark">
    <meta name="theme-color" content="#f2f2f7">

    <!-- Theme preflight (before CSS):
         - Prevent light-mode overlay scrollbars becoming white (invisible) on mobile/PWA
         - Reduce first-paint flicker by setting data-theme early -->
    <script>
        (function () {
            try {
                var mode = localStorage.getItem('musixquare-theme') || 'system';
                var resolved = (mode === 'dark') ? 'dark' : (mode === 'light') ? 'light'
                    : (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) ? 'dark' : 'light';

                document.documentElement.setAttribute('data-theme', resolved);
                document.documentElement.style.colorScheme = resolved;

                // Match status-bar / address-bar color on first paint
                var themeColor = (resolved === 'dark') ? '#000000' : '#f2f2f7';
                var m = document.querySelector('meta[name="theme-color"]');
                if (m) m.setAttribute('content', themeColor);

                var cs = document.querySelector('meta[name="color-scheme"]');
                if (cs) cs.setAttribute('content', resolved);
            } catch (e) { }
        })();
    </script>
    <meta name="application-name" content="MUSIXQUARE">
    <meta name="apple-mobile-web-app-title" content="MUSIXQUARE">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    <meta name="google-site-verification" content="7fu3Buf9PDMn-9nYRnTCz5-Xx14d4gQAM90ZY5wdfQE" />
    <meta name="naver-site-verification" content="7c6a96babe7b3cdd2ee8afc2f6ce388f8b2bef31" />
    <meta property="og:title" content="MUSIXQUARE">
    <meta property="og:description" content="여러 기기를 연결해 동기화된 서라운드 사운드를 만들어 보세요. P2P 기반 실시간 오디오 동기화 웹앱.">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="MUSIXQUARE">
    <meta property="og:locale" content="ko_KR">
    <meta property="og:url" content="https://mxqr.netlify.app/">
    <meta property="og:image" content="https://mxqr.netlify.app/icons/icon-512.png">
    <meta property="og:image:width" content="512">
    <meta property="og:image:height" content="512">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="MUSIXQUARE">
    <meta name="twitter:description" content="여러 기기를 연결해 동기화된 서라운드 사운드를 만들어 보세요. P2P 기반 실시간 오디오 동기화 웹앱.">
    <meta name="twitter:image" content="https://mxqr.netlify.app/icons/icon-512.png">
    <title>MUSIXQUARE</title>
    <meta name="description" content="MUSIXQUARE - 여러 기기를 연결해 동기화된 서라운드 사운드를 만들어 보세요. P2P 기반 실시간 오디오 동기화 웹앱.">
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="manifest" href="/manifest.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="icons/icon-180.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-32.png">
    <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192.png">

    <!-- FOUC guard: hide body until stylesheets are parsed.
         Removed by the rAF poll below (checks for --bg CSS variable from style.css). -->
    <style id="fouc-guard">
        body { opacity: 0 !important; }
    </style>

    <!-- Web font: Pretendard (consistent across Windows / Android / iOS / macOS) -->
    <link rel="stylesheet" href="css/pretendard.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/desktop.css">

    <!-- Remove FOUC guard as soon as CSS is parsed (works with both dev & Vite-bundled builds).
         Polls via rAF for the --bg custom property defined in :root — typically resolves in 1-2 frames. -->
    <script>
        (function () {
            var g = document.getElementById('fouc-guard');
            if (!g) return;
            function check() {
                if (getComputedStyle(document.documentElement).getPropertyValue('--bg').trim()) {
                    g.remove();
                } else {
                    requestAnimationFrame(check);
                }
            }
            requestAnimationFrame(check);
            setTimeout(function () { if (g.parentNode) g.remove(); }, 3000);
        })();
    </script>

    <!-- Setup overlay: cap to the *visible* viewport height (no clipping on Android tablets).
         iOS standalone (PWA) is excluded from the body clamp because CSS units (100%, 100dvh)
         exclude safe-area-inset-top — platform.ts handles it via JS instead. -->
    <style id="viewport-safe">
        html:not(.ios-standalone) body {
            max-height: var(--app-height, 100dvh) !important;
        }

        /* Generic overlays (setup / media / YouTube URL) */
        .onboarding-overlay {
            max-height: var(--app-height, 100dvh) !important;
        }

        .onboarding-overlay .setup-card.full-screen {
            height: var(--app-height, 100dvh) !important;
            max-height: var(--app-height, 100dvh) !important;
        }

        .onboarding-overlay .setup-mobile-view {
            max-height: var(--app-height, 100dvh) !important;
            overflow-y: auto;
        }
    </style>
</head>

<body>

    <!-- (Removed) Mobile portrait-only overlay: we support landscape/tablet usage. -->

    <noscript>
        <div
            style="padding:16px; background:#111; color:#fff; font-family:system-ui, -apple-system, Segoe UI, Roboto, sans-serif;">
            MUSIXQUARE는 JavaScript가 필요해요. 브라우저 설정에서 JavaScript를 켠 뒤 다시 시도해 주세요.
        </div>
    </noscript>




    <header id="main-header">
        <div class="header-progress-bg" id="header-progress-bg"></div>

        <div class="header-content-wrapper">
            <div class="app-logo header-default-content" id="app-logo" role="button" tabindex="0"
                aria-label="" data-i18n-aria-label="nav.go_home">MUSI<span class="logo-fade">XQUARE</span></div>
            <div class="header-loading-text" id="header-loading-text">Loading...</div>
        </div>

        <div class="header-right header-default-content" style="display: flex; align-items: center;">
            <div class="role-badge" id="role-badge">
                <div class="role-dot"></div>
                <span id="role-text">OFFLINE</span>
            </div>
        </div>
    </header>

    <div id="tab-play" class="tab-content active" role="tabpanel">
        <div class="tab-header play-header-desktop">
            <span class="tab-title" data-i18n="nav.home">홈</span>
        </div>
        <div class="tab-body">
            <div class="vinyl-wrapper">
                <canvas id="visualizerCanvas" aria-label="" data-i18n-aria-label="player.visualizer"></canvas>

            </div>

            <div class="video-wrapper">
                <video id="main-video" class="video-screen" playsinline webkit-playsinline></video>
                <button class="fullscreen-btn" id="btn-fullscreen" aria-label="" data-i18n-aria-label="player.fullscreen">
                    <svg viewBox="0 0 24 24">
                        <path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z" />
                    </svg>
                </button>
            </div>

            <div class="track-box">
                <div class="track-title-wrapper">
                    <div class="track-title" id="track-title" data-i18n="player.no_media">미디어 없음</div>
                </div>
                <div class="track-artist" id="track-artist" data-i18n="player.select_file_hint">파일을 추가하거나 YouTube 링크를 입력하세요</div>
            </div>

            <div class="controls-area">
                <div class="progress-bar">
                    <input type="range" id="seek-slider" min="0" max="100" value="0" step="0.1" aria-label="" data-i18n-aria-label="player.seek">
                    <div class="time-info">
                        <span id="time-curr">0:00</span>
                        <span id="time-dur">0:00</span>
                    </div>
                </div>

                <div class="play-controls-left">
                    <div class="play-btn-group">
                        <button class="ctrl-btn" id="btn-prev" aria-label="" data-i18n-aria-label="player.prev_track">
                            <svg viewBox="0 0 24 24">
                                <path d="M6 6h2v12H6zm3.5 6l8.5 6V6z" />
                            </svg>
                        </button>
                        <button class="play-fab" id="play-btn" aria-label="" data-i18n-aria-label="player.play_pause" disabled>
                            <svg id="icon-play" viewBox="0 0 24 24">
                                <path d="M8 5v14l11-7z" />
                            </svg>
                            <svg id="icon-pause" viewBox="0 0 24 24" style="display:none">
                                <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z" />
                            </svg>
                        </button>
                        <button class="ctrl-btn" id="btn-next" aria-label="" data-i18n-aria-label="player.next_track">
                            <svg viewBox="0 0 24 24">
                                <path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z" />
                            </svg>
                        </button>
                    </div>

                    <div class="vol-group-playback">
                        <svg id="vol-icon-btn" viewBox="0 0 24 24" style="cursor: pointer">
                            <path
                                d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z" />
                        </svg>
                        <input type="range" id="volume-slider" min="0" max="100" value="100" aria-label="" data-i18n-aria-label="player.volume">
                    </div>
                </div>

                <!-- Chat Preview Button -->
                <button type="button" class="chat-preview-btn" id="chat-preview-btn" aria-label="" data-i18n-aria-label="chat.open">
                    <div class="chat-preview-left">
                        <svg viewBox="0 0 24 24" class="chat-preview-icon">
                            <path
                                d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z" />
                        </svg>
                        <span class="chat-preview-text" id="chat-preview-text" data-i18n="chat.start"></span>
                    </div>
                    <span class="chat-preview-badge" id="chat-preview-badge"></span>
                </button>

                <!-- Buttons Row: SYNC (left) + Media (right) -->
                <div class="play-action-buttons" style="display:flex; gap:12px;">
                    <button class="file-select-btn file-select-btn-large" id="btn-sync" style="flex:1;">
                        <svg viewBox="0 0 24 24">
                            <path
                                d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z" />
                        </svg>
                        <span data-i18n="common.sync"></span>
                    </button>
                    <button class="file-select-btn file-select-btn-large" id="btn-media-source" style="flex:1;">
                        <svg viewBox="0 0 24 24">
                            <path
                                d="M21 3H3c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H3V5h18v14zM9 8l7 4-7 4V8z" />
                        </svg>
                        <span data-i18n="player.play_media"></span>
                    </button>
                </div>

                <input type="file" id="file-input" multiple aria-label="" data-i18n-aria-label="help.local_file"
                    accept=".mp3, .wav, .ogg, .m4a, .mp4, .webm, .mkv, audio/*, video/*" style="display:none">
            </div>
        </div>
    </div>

    <div id="tab-playlist" class="tab-content" role="tabpanel">
        <div class="tab-header">
            <span class="tab-title" data-i18n="nav.playlist">플레이리스트</span>
            <div class="playlist-title-area">
                <button class="tab-action-btn" id="btn-repeat" aria-label="" data-i18n-aria-label="player.repeat_mode">
                    <svg viewBox="0 0 24 24">
                        <path d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z" />
                    </svg>
                </button>
                <button class="tab-action-btn" id="btn-shuffle" aria-label="" data-i18n-aria-label="player.shuffle_mode">
                    <svg viewBox="0 0 24 24">
                        <path
                            d="M10.59 9.17L5.41 4 4 5.41l5.17 5.17 1.42-1.41zM14.5 4l2.04 2.04L4 18.59 5.41 20 17.96 7.46 20 9.5V4h-5.5zm.33 9.41l-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04 2.04-3.13-3.13z" />
                    </svg>
                </button>
                <button class="tab-action-btn" id="btn-add-media" aria-label="" data-i18n-aria-label="player.add_media">
                    <svg viewBox="0 0 24 24">
                        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                    </svg>
                </button>
            </div>
        </div>
        <div class="tab-body">
            <ul class="playlist-ul" id="playlist-ui">
                <li class="list-empty-state" data-i18n="playlist.empty_hint"></li>
            </ul>
        </div>
    </div>

    <div id="tab-guide" class="tab-content" role="tabpanel">
        <div class="tab-header" style="justify-content: space-between; align-items: center;">
            <div style="display: flex; align-items: center; gap: 8px;">
                <span class="tab-title" data-i18n="nav.help"></span>
                <button id="btn-close-guide" type="button" aria-label="" data-i18n-aria-label="common.close"
                    style="display:none; background:transparent; border:none; color:var(--text-main); cursor:pointer;"><svg
                        viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                        <path
                            d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
                    </svg></button>
            </div>
            <div class="settings-invite-wrapper invite-code-container"
                style="text-align: right; cursor: pointer; display: flex; flex-direction: column; align-items: flex-end;"
                title="" data-i18n-title="toast.click_copy_invite">
                <div
                    style="font-size: 9px; font-weight: 700; color: var(--text-sub); letter-spacing: 0.1em; margin-bottom: 2px; text-align: right;"
                    data-i18n="settings.invite_code"></div>
                <span class="invite-code-value"
                    style="font-size: 16px; font-weight: 800; font-variant-numeric: tabular-nums; letter-spacing: 0.1em; text-align: right;">------</span>
            </div>
        </div>

        <div class="tab-body">

            <div class="help-block">
                <div class="help-title">
                    <svg viewBox="0 0 24 24">
                        <path
                            d="M1 9l2 2c4.97-4.97 13.03-4.97 18 0l2-2C16.93 2.93 7.08 2.93 1 9zm8 8l3 3 3-3c-1.65-1.66-4.34-1.66-6 0zm-4-4l2 2c2.76-2.76 7.24-2.76 10 0l2-2C15.14 9.14 8.87 9.14 5 13z" />
                    </svg>
                    <span data-i18n="help.local_recommended"></span>
                </div>
                <div class="help-desc" data-i18n-html="help.local_recommended_html">
                </div>
            </div>

            <div class="help-block">
                <div class="help-title">
                    <svg viewBox="0 0 24 24">
                        <path
                            d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z" />
                    </svg>
                    <span data-i18n="setup.how_to_connect"></span>
                </div>
                <div class="help-desc" data-i18n-html="setup.how_to_connect_html">
                </div>
            </div>

            <div class="help-block">
                <div class="help-title">
                    <svg viewBox="0 0 24 24">
                        <path
                            d="M17 2H7c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-5 2c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2zm0 16c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z" />
                    </svg>
                    <span data-i18n="player.play_speakers"></span>
                </div>
                <div class="help-desc" data-i18n-html="player.play_speakers_html">
                </div>
            </div>

            <div class="help-block">
                <div class="help-title">
                    <svg viewBox="0 0 24 24">
                        <path d="M9 16h6v-6h4l-7-7-7 7h4zm-4 2h14v2H5z" />
                    </svg>
                    <span data-i18n="player.play_media_action"></span>
                </div>
                <div class="help-desc" data-i18n-html="player.play_media_action_html">
                    <button class="demo-btn" id="btn-demo-guide"
                        style="width:100%; margin-top:12px; justify-content:center;">
                        <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                            <path
                                d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-8 12.5v-9l6 4.5-6 4.5z" />
                        </svg>
                        <span data-i18n="setup.demo_button"></span>
                    </button>
                </div>
            </div>

            <div class="help-block">
                <div class="help-title">
                    <svg viewBox="0 0 24 24">
                        <path
                            d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-.83.45-1.54 1.17-2.25l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z" />
                    </svg>
                    <span data-i18n="help.need_help"></span>
                </div>
                <div class="help-desc" data-i18n-html="help.need_help_html">
                </div>
            </div> <!-- Ends help-block -->
        </div> <!-- Ends tab-body -->
    </div> <!-- Ends tab-guide -->

    <div id="tab-settings" class="tab-content" role="tabpanel">
        <div class="tab-header" style="justify-content: space-between; align-items: center; padding-bottom: 0px;">
            <span class="tab-title" data-i18n="nav.settings"></span>
            <div class="settings-invite-wrapper invite-code-container"
                style="text-align: right; cursor: pointer; display: flex; flex-direction: column; align-items: flex-end;"
                title="" data-i18n-title="toast.click_copy_invite">
                <div
                    style="font-size: 9px; font-weight: 700; color: var(--text-sub); letter-spacing: 0.1em; margin-bottom: 2px; text-align: right;"
                    data-i18n="settings.invite_code"></div>
                <span class="invite-code-value"
                    style="font-size: 16px; font-weight: 800; font-variant-numeric: tabular-nums; letter-spacing: 0.1em; text-align: right;">------</span>
            </div>
        </div>

        <div class="tab-body">
            <div class="section-group">
                <div class="section-header-row">
                    <span class="section-title" data-i18n="settings.language"></span>
                </div>
                <div class="lang-selector">
                    <div class="lang-opt" id="lang-ko">한국어</div>
                    <div class="lang-opt" id="lang-en">English</div>
                    <div class="lang-opt" id="lang-system" data-i18n="settings.system"></div>
                </div>
            </div>

            <div class="section-group" id="theme-section">
                <div class="section-header-row">
                    <span class="section-title" data-i18n="settings.theme"></span>
                </div>
                <div class="theme-selector">
                    <div class="theme-opt" id="theme-light" data-i18n="settings.light"></div>
                    <div class="theme-opt" id="theme-dark" data-i18n="settings.dark"></div>
                    <div class="theme-opt" id="theme-system" data-i18n="settings.system"></div>
                </div>
            </div>

            <!-- YouTube mode notice (shown only while PLAYING_YOUTUBE) -->
            <div class="youtube-settings-note" id="youtube-settings-note" role="note" data-i18n="help.youtube_no_effects">
            </div>

            <!-- Everything below (except Theme) will be blurred/disabled in YouTube mode -->
            <div id="youtube-settings-disabled-wrap">

                <!-- 1. Speaker Role -->
                <div class="section-group">
                    <div class="section-header-row">
                        <span class="section-title" data-i18n="setup.set_role"></span>
                    </div>

                    <!-- Standard Channel Grid (Stereo/L/R/Woofer) -->
                    <div class="channel-grid" id="grid-standard">
                        <div class="ch-opt" data-ch="-1">
                            <svg viewBox="0 0 24 24">
                                <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" />
                            </svg><span data-i18n="role.left"></span>
                        </div>
                        <div class="ch-opt" data-ch="1">
                            <svg viewBox="0 0 24 24">
                                <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z" />
                            </svg><span data-i18n="role.right"></span>
                        </div>
                        <div class="ch-opt" data-ch="2">
                            <svg viewBox="0 0 24 24">
                                <path
                                    d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z" />
                                <circle cx="12" cy="12" r="3" />
                            </svg><span data-i18n="role.subwoofer"></span>
                        </div>
                        <div class="ch-opt" data-ch="0">
                            <svg viewBox="0 0 24 24">
                                <path
                                    d="M12 3v9.28c-.47-.17-.97-.28-1.5-.28C8.01 12 6 14.01 6 16.5S8.01 21 10.5 21c2.31 0 4.16-1.75 4.45-4H15V6h4V3h-7z" />
                            </svg><span data-i18n="role.center"></span>
                        </div>
                    </div>
                    <!-- Woofer Control -->
                    <div class="slider-wrap" id="woofer-cutoff-control">
                        <div class="slider-header">
                            <span data-i18n="settings.subwoofer_adjust"></span>
                            <span class="val-disp" id="val-cutoff">120 Hz</span>
                        </div>
                        <input type="range" id="cutoff-slider" min="60" max="200" value="120" aria-label="" data-i18n-aria-label="settings.subwoofer_cutoff">
                    </div>
                </div>

                <!-- 2. Reverb -->
                <div class="section-group">
                    <div class="section-header-row">
                        <span class="section-title" data-i18n="settings.reverb_host_ctrl"></span>
                        <button class="btn-action" style="padding:4px 12px; height:28px; font-size:11px;"
                            id="btn-reset-reverb" data-i18n="common.reset"></button>
                    </div>
                    <div class="slider-wrap">
                        <div class="slider-header">
                            <span><span data-i18n="common.mix"></span> <span
                                    style="font-size:10px; color:var(--text-sub); font-weight:normal; margin-left:4px;" data-i18n="settings.default_0pct"></span></span>
                            <span class="val-disp" id="val-reverb">0%</span>
                        </div>
                        <input type="range" id="reverb-slider" min="0" max="100" value="0" aria-label="" data-i18n-aria-label="settings.reverb_mix">
                    </div>

                    <!-- Decay Slider -->
                    <div class="slider-wrap">
                        <div class="slider-header">
                            <span><span data-i18n="settings.decay_time"></span> <span
                                    style="font-size:10px; color:var(--text-sub); font-weight:normal; margin-left:4px;" data-i18n="settings.default_5s"></span></span>
                            <span class="val-disp" id="val-rvb-decay">5.0s</span>
                        </div>
                        <input type="range" id="reverb-decay-slider" min="0.1" max="10.0" step="0.1" value="5.0"
                            aria-label="" data-i18n-aria-label="settings.reverb_decay">
                    </div>

                    <!-- Pre-Delay Slider -->
                    <div class="slider-wrap">
                        <div class="slider-header">
                            <span><span data-i18n="settings.predelay"></span> <span
                                    style="font-size:10px; color:var(--text-sub); font-weight:normal; margin-left:4px;" data-i18n="settings.default_01s"></span></span>
                            <span class="val-disp" id="val-rvb-predelay">0.1s</span>
                        </div>
                        <input type="range" id="reverb-predelay-slider" min="0" max="0.5" step="0.01" value="0.1"
                            aria-label="" data-i18n-aria-label="settings.reverb_predelay">
                    </div>

                    <!-- Low Cut Slider (New) -->
                    <div class="slider-wrap">
                        <div class="slider-header">
                            <span><span data-i18n="settings.highpass"></span> <span
                                    style="font-size:10px; color:var(--text-sub); font-weight:normal; margin-left:4px;" data-i18n="settings.default_20hz"></span></span>
                            <span class="val-disp" id="val-rvb-lowcut">20Hz</span>
                        </div>
                        <input type="range" id="reverb-lowcut-slider" min="0" max="100" step="1" value="0"
                            aria-label="" data-i18n-aria-label="settings.reverb_lowcut">
                    </div>

                    <!-- High Cut Slider (New) -->
                    <div class="slider-wrap">
                        <div class="slider-header">
                            <span><span data-i18n="settings.lowpass"></span> <span
                                    style="font-size:10px; color:var(--text-sub); font-weight:normal; margin-left:4px;" data-i18n="settings.default_20khz"></span></span>
                            <span class="val-disp" id="val-rvb-highcut">20.0kHz</span>
                        </div>
                        <input type="range" id="reverb-highcut-slider" min="0" max="100" step="1" value="0"
                            aria-label="" data-i18n-aria-label="settings.reverb_highcut">
                    </div>
                </div>

                <!-- 3. Equalizer -->
                <div class="section-group">
                    <div class="section-header-row">
                        <span class="section-title" data-i18n="settings.eq_host_ctrl"></span>
                        <button class="btn-action" style="padding:4px 12px; height:28px; font-size:11px;"
                            id="btn-reset-eq" data-i18n="common.reset"></button>
                    </div>

                    <!-- Preamp -->
                    <div class="slider-wrap" id="preamp-control">
                        <div class="slider-header">
                            <span style="font-size:11px; font-weight:700; color:var(--text-sub);" data-i18n="settings.preamp"></span>
                            <span class="val-disp" id="val-preamp" style="font-size:11px;">0dB</span>
                        </div>
                        <input type="range" id="preamp-slider" min="-12" max="12" value="0" aria-label="" data-i18n-aria-label="settings.preamp_gain">
                    </div>
                    <div class="eq-container">
                        <div class="eq-band">
                            <span class="eq-val" id="eq-val-0">0</span>
                            <input type="range" class="eq-slider" min="-12" max="12" value="0" id="eq-slider-0"
                                aria-label="EQ 60Hz">
                            <span class="eq-label">60</span>
                        </div>
                        <div class="eq-band">
                            <span class="eq-val" id="eq-val-1">0</span>
                            <input type="range" class="eq-slider" min="-12" max="12" value="0" id="eq-slider-1"
                                aria-label="EQ 230Hz">
                            <span class="eq-label">230</span>
                        </div>
                        <div class="eq-band">
                            <span class="eq-val" id="eq-val-2">0</span>
                            <input type="range" class="eq-slider" min="-12" max="12" value="0" id="eq-slider-2"
                                aria-label="EQ 910Hz">
                            <span class="eq-label">910</span>
                        </div>
                        <div class="eq-band">
                            <span class="eq-val" id="eq-val-3">0</span>
                            <input type="range" class="eq-slider" min="-12" max="12" value="0" id="eq-slider-3"
                                aria-label="EQ 3.6kHz">
                            <span class="eq-label">3.6k</span>
                        </div>
                        <div class="eq-band">
                            <span class="eq-val" id="eq-val-4">0</span>
                            <input type="range" class="eq-slider" min="-12" max="12" value="0" id="eq-slider-4"
                                aria-label="EQ 14kHz">
                            <span class="eq-label">14k</span>
                        </div>
                    </div>
                </div>

                <!-- 4. Virtual Surround -->
                <div class="section-group">
                    <div class="section-header-row">
                        <span class="section-title" data-i18n="settings.surround_host_ctrl"></span>
                        <button class="btn-action" style="padding:4px 12px; height:28px; font-size:11px;"
                            id="btn-reset-stereo" data-i18n="common.reset"></button>
                    </div>
                    <div class="slider-wrap">
                        <div class="slider-header">
                            <span><span data-i18n="common.width"></span> <span
                                    style="font-size:10px; color:var(--text-sub); font-weight:normal; margin-left:4px;"
                                    data-i18n="settings.default_100_surround"></span></span>
                            <span class="val-disp" id="val-width">100%</span>
                        </div>
                        <input type="range" id="width-slider" min="0" max="200" value="100" aria-label="" data-i18n-aria-label="settings.surround_width">
                    </div>
                </div>

                <!-- 5. Virtual Bass -->
                <div class="section-group" id="last-setting-section">
                    <div class="section-header-row">
                        <span class="section-title" data-i18n="settings.bass_host_ctrl"></span>
                        <button class="btn-action" style="padding:4px 12px; height:28px; font-size:11px;"
                            id="btn-reset-vbass" data-i18n="common.reset"></button>
                    </div>
                    <div class="slider-wrap">
                        <div class="slider-header">
                            <span><span data-i18n="common.intensity"></span> <span
                                    style="font-size:10px; color:var(--text-sub); font-weight:normal; margin-left:4px;"
                                    data-i18n="settings.default_0_distortion"></span></span>
                            <span class="val-disp" id="val-vbass">0%</span>
                        </div>
                        <input type="range" id="vbass-slider" min="0" max="100" value="0" aria-label="" data-i18n-aria-label="settings.bass_intensity">
                    </div>
                </div>

            </div> <!-- End of youtube-settings-disabled-wrap -->

            <div class="desktop-help-section">

                <div class="help-block" style="margin-top: 16px;">
                    <div class="help-title">
                        <svg viewBox="0 0 24 24">
                            <path
                                d="M1 9l2 2c4.97-4.97 13.03-4.97 18 0l2-2C16.93 2.93 7.08 2.93 1 9zm8 8l3 3 3-3c-1.65-1.66-4.34-1.66-6 0zm-4-4l2 2c2.76-2.76 7.24-2.76 10 0l2-2C15.14 9.14 8.87 9.14 5 13z" />
                        </svg>
                        <span data-i18n="help.local_recommended"></span>
                    </div>
                    <div class="help-desc" data-i18n-html="help.local_recommended_html">
                    </div>
                </div>

                <div class="help-block">
                    <div class="help-title">
                        <svg viewBox="0 0 24 24">
                            <path
                                d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z" />
                        </svg>
                        <span data-i18n="setup.how_to_connect"></span>
                    </div>
                    <div class="help-desc" data-i18n-html="setup.how_to_connect_html">
                    </div>
                </div>

                <div class="help-block">
                    <div class="help-title">
                        <svg viewBox="0 0 24 24">
                            <path
                                d="M17 2H7c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-5 2c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2zm0 16c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z" />
                        </svg>
                        <span data-i18n="player.play_speakers"></span>
                    </div>
                    <div class="help-desc" data-i18n-html="player.play_speakers_html">
                    </div>
                </div>

                <div class="help-block">
                    <div class="help-title">
                        <svg viewBox="0 0 24 24">
                            <path d="M9 16h6v-6h4l-7-7-7 7h4zm-4 2h14v2H5z" />
                        </svg>
                        <span data-i18n="player.play_media_action"></span>
                    </div>
                    <div class="help-desc" data-i18n-html="player.play_media_action_html">
                    </div>
                </div>

                <div class="help-block">
                    <div class="help-title">
                        <svg viewBox="0 0 24 24">
                            <path
                                d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-.83.45-1.54 1.17-2.25l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z" />
                        </svg>
                        <span data-i18n="help.need_help"></span>
                    </div>
                    <div class="help-desc" data-i18n-html="help.need_help_html">
                    </div>
                </div> <!-- Ends help-block -->
            </div> <!-- Ends desktop-help-section -->
        </div> <!-- Ends tab-body -->
    </div> <!-- Ends tab-settings -->


    <!-- Slide-up Chat Drawer -->
    <div class="chat-drawer" id="chat-drawer">
        <div class="chat-drawer-header">
            <span class="chat-drawer-title" data-i18n="chat.title"></span>
            <button class="chat-drawer-close" id="btn-chat-close" aria-label="" data-i18n-aria-label="chat.close">
                <svg viewBox="0 0 24 24">
                    <path
                        d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
                </svg>
            </button>
        </div>
        <div class="chat-drawer-messages" id="chat-messages" role="log" aria-live="polite">
            <div class="chat-empty" data-i18n-html="chat.empty_html"></div>
        </div>
        <div class="chat-drawer-input">
            <div class="chat-input-wrapper">
                <input type="text" class="chat-input" id="chat-input" placeholder="" maxlength="200"
                    aria-label="" data-i18n-placeholder="chat.placeholder" data-i18n-aria-label="chat.input_label">
                <button class="chat-send-btn" id="btn-chat-send" aria-label="" data-i18n-aria-label="chat.send">
                    <svg viewBox="0 0 24 24">
                        <path d="M4 12l1.41 1.41L11 7.83V20h2V7.83l5.58 5.59L20 12l-8-8-8 8z" />
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Blur halo: blurs content around tab bar (mask-image, iOS-optimized) -->
    <div class="nav-blur-halo" aria-hidden="true"></div>

    <nav class="bottom-nav" role="tablist">
        <button class="nav-item active" data-tab="play" role="tab" aria-selected="true" aria-controls="tab-play">
            <svg viewBox="0 0 24 24">
                <path
                    d="M12 3v9.28c-.47-.17-.97-.28-1.5-.28C8.01 12 6 14.01 6 16.5S8.01 21 10.5 21c2.31 0 4.16-1.75 4.45-4H15V6h4V3h-7z" />
            </svg>
            <span data-i18n="nav.home"></span>
        </button>
        <button class="nav-item" data-tab="playlist" role="tab" aria-selected="false" aria-controls="tab-playlist">
            <svg viewBox="0 0 24 24">
                <path
                    d="M15 6H3v2h12V6zm0 4H3v2h12v-2zM3 16h8v-2H3v2zM17 6v8.18c-.31-.11-.65-.18-1-.18-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3V8h3V6h-5z" />
            </svg>
            <span data-i18n="nav.playlist"></span>
        </button>
        <button class="nav-item" data-tab="settings" role="tab" aria-selected="false" aria-controls="tab-settings">
            <svg viewBox="0 0 24 24">
                <path
                    d="M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z" />
            </svg>
            <span class="nav-text-mobile" data-i18n="nav.settings"></span>
            <span class="nav-text-desktop" data-i18n="nav.settings_help"></span>
        </button>
        <button class="nav-item" data-tab="guide" role="tab" aria-selected="false" aria-controls="tab-guide">
            <svg viewBox="0 0 24 24">
                <path
                    d="M11 18h2v-2h-2v2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4z" />
            </svg>
            <span data-i18n="nav.help"></span>
        </button>
    </nav>

    <audio id="silent-trigger" src="dummy_audio.mp3" preload="auto" x-webkit-airplay="allow" playsinline
        webkit-playsinline loop></audio>

    <div id="setup-overlay" class="onboarding-overlay">
        <div class="onboarding-card setup-card full-screen">
            <!-- PC Desktop Brand Section -->
            <div id="setup-desktop-brand" class="setup-desktop-brand">
                <div class="brand-content">
                    <h1 class="brand-logo">MUSIXQUARE</h1>
                    <p class="brand-tagline" data-i18n-html="setup.brand_tagline_html"></p>
                </div>
                <!-- Desktop: dynamic step header (mirrored from right panel via JS) -->
                <div id="desktop-step-header" class="desktop-step-header"></div>
                <!-- Desktop: diagram/slider area (moved from right panel via JS) -->
                <div id="desktop-diagram-area" class="desktop-diagram-area"></div>
            </div>

            <!-- Mobile UI / PC Right Panel Wrapper -->
            <div class="setup-mobile-view">
                <div class="setup-header-pill" style="display:none;"></div>
                <!-- Reserved for any extra header info -->

                <!-- Welcome Slides (Shown first) -->
                <!-- Welcome Area (Header + Slider) -->
                <div id="setup-welcome-area" style="width: 100%; display: flex; flex-direction: column; flex: 1;">
                    <div id="setup-welcome-header" class="setup-header-text">
                        <h2>MUSIXQUARE</h2>
                        <p data-i18n="setup.hello_select_role"></p>
                    </div>

                    <div id="ob-slider-area" style="display:block; width:100%; position: relative; flex: 1;">
                        <div class="ob-slider-viewport" id="ob-slider-viewport">
                            <div class="ob-slider-track" id="ob-slider-track">
                                <!-- Slide 1: Invite -->
                                <div class="ob-slide">
                                    <div class="ob-icon-circle">
                                        <svg viewBox="0 0 24 24">
                                            <path
                                                d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z" />
                                        </svg>
                                    </div>
                                    <div class="ob-title" data-i18n="settings.invite_share"></div>
                                    <div class="ob-desc" data-i18n-html="setup.invite_share_desc_html">
                                    </div>
                                </div>
                                <!-- Slide 2: Sync -->
                                <div class="ob-slide">
                                    <div class="ob-icon-circle">
                                        <svg viewBox="0 0 24 24">
                                            <path
                                                d="M12 3v9.28c-.47-.17-.97-.28-1.5-.28C8.01 12 6 14.01 6 16.5S8.01 21 10.5 21c2.31 0 4.16-1.75 4.45-4H15V6h4V3h-7z" />
                                        </svg>
                                    </div>
                                    <div class="ob-title" data-i18n="player.play_together"></div>
                                    <div class="ob-desc" data-i18n-html="setup.play_together_desc_html">
                                    </div>
                                </div>
                                <!-- Slide 3: Surround -->
                                <div class="ob-slide">
                                    <div class="ob-icon-circle">
                                        <svg viewBox="0 0 24 24">
                                            <path
                                                d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z" />
                                            <circle cx="12" cy="12" r="3" />
                                        </svg>
                                    </div>
                                    <div class="ob-title" data-i18n="settings.spatial_audio"></div>
                                    <div class="ob-desc" data-i18n-html="setup.spatial_audio_desc_html">
                                    </div>
                                </div>
                                <!-- Slide 4: Advanced Audio -->
                                <div class="ob-slide">
                                    <div class="ob-icon-circle">
                                        <svg viewBox="0 0 24 24">
                                            <path d="M10 20h4V4h-4v16zm-6 0h4v-8H4v8zM16 9v11h4V9h-4z" />
                                        </svg>
                                    </div>
                                    <div class="ob-title" data-i18n="settings.advanced_audio"></div>
                                    <div class="ob-desc" data-i18n-html="setup.advanced_audio_desc_html">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="ob-nav-row">
                            <button class="ob-nav-arrow ob-nav-prev" id="ob-prev" aria-label="" data-i18n-aria-label="common.previous">
                                <svg viewBox="0 0 12 12" width="10" height="10">
                                    <path d="M8 1L3 6l5 5" fill="none" stroke="currentColor" stroke-width="1.8"
                                        stroke-linecap="round" stroke-linejoin="round" />
                                </svg>
                            </button>
                            <div class="ob-dots" id="ob-dots">
                                <div class="ob-dot active" data-idx="0"></div>
                                <div class="ob-dot" data-idx="1"></div>
                                <div class="ob-dot" data-idx="2"></div>
                                <div class="ob-dot" data-idx="3"></div>
                            </div>
                            <button class="ob-nav-arrow ob-nav-next" id="ob-next" aria-label="" data-i18n-aria-label="common.next_desc">
                                <svg viewBox="0 0 12 12" width="10" height="10">
                                    <path d="M4 1l5 5-5 5" fill="none" stroke="currentColor" stroke-width="1.8"
                                        stroke-linecap="round" stroke-linejoin="round" />
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Host: Connection Guide + Short Code -->
                <div id="setup-code-area" class="setup-code-area" style="display:none;">
                    <div class="setup-header-text">
                        <h2 data-i18n="setup.last_step"></h2>
                        <p data-i18n="setup.connect_devices"></p>
                    </div>
                    <div class="setup-guide-unified">
                        <!-- Method 1: WiFi -->
                        <div class="setup-unified-item">
                            <svg class="setup-graphic-svg" viewBox="0 0 200 85" style="height: 70px;">
                                <!-- Material WiFi Icon Centered -->
                                <path transform="translate(88, 10) scale(1)" fill="var(--primary)"
                                    d="M1 9l2 2c4.97-4.97 13.03-4.97 18 0l2-2C16.93 2.93 7.08 2.93 1 9zm8 8l3 3 3-3c-1.65-1.66-4.34-1.66-6 0zm-4-4l2 2c2.76-2.76 7.24-2.76 10 0l2-2C15.14 9.14 8.87 9.14 5 13z" />
                                <!-- Connecting Lines -->
                                <line x1="100" y1="36" x2="40" y2="55" class="graphic-line-active"
                                    stroke-opacity="0.5" />
                                <line x1="100" y1="36" x2="80" y2="55" class="graphic-line-active"
                                    stroke-opacity="0.5" />
                                <line x1="100" y1="36" x2="120" y2="55" class="graphic-line-active"
                                    stroke-opacity="0.5" />
                                <line x1="100" y1="36" x2="160" y2="55" class="graphic-line-active"
                                    stroke-opacity="0.5" />
                                <!-- Devices -->
                                <rect x="32" y="50" width="16" height="20" rx="3" class="graphic-device"
                                    style="stroke:var(--primary); stroke-width:2;" />
                                <rect x="72" y="50" width="16" height="20" rx="3" class="graphic-device" />
                                <rect x="112" y="50" width="16" height="20" rx="3" class="graphic-device" />
                                <rect x="152" y="50" width="16" height="20" rx="3" class="graphic-device" />
                            </svg>
                            <div class="setup-inner-desc" data-i18n="help.connect_all_wifi"></div>
                        </div>

                        <!-- Method 2: Hotspot -->
                        <div class="setup-unified-item">
                            <svg class="setup-graphic-svg" viewBox="0 0 200 90" style="height: 70px;">
                                <g transform="translate(0, 5)">
                                    <rect x="30" y="25" width="22" height="38" rx="4" class="graphic-device"
                                        style="stroke:var(--primary); stroke-width:2;" />
                                    <circle cx="41" cy="44" r="5" fill="var(--primary)" opacity="0.2" />
                                    <line x1="55" y1="44" x2="115" y2="15" class="graphic-line-active" />
                                    <line x1="55" y1="44" x2="135" y2="44" class="graphic-line-active" />
                                    <line x1="55" y1="44" x2="115" y2="73" class="graphic-line-active" />
                                    <rect x="120" y="5" width="16" height="26" rx="3" class="graphic-device" />
                                    <rect x="140" y="31" width="16" height="26" rx="3" class="graphic-device" />
                                    <rect x="120" y="57" width="16" height="26" rx="3" class="graphic-device" />
                                </g>
                            </svg>
                            <div class="setup-inner-desc" data-i18n="help.wifi_hotspot"></div>
                        </div>
                    </div>

                    <div class="setup-code-area-bottom">
                        <div class="setup-code-label" data-i18n="setup.enter_code_connect"></div>
                        <input type="text" class="setup-join-input" id="setup-code" value="------" readonly
                            style="border-bottom: 2px solid transparent; opacity: 1; -webkit-text-fill-color: var(--text-main); color: var(--text-main);">
                    </div>
                </div>

                <!-- Guest: Connection Guide + Input -->
                <div id="setup-join-area" style="display:none; width:100%;">
                    <div class="setup-header-text">
                        <h2 data-i18n="setup.last_step"></h2>
                        <p data-i18n="setup.enter_host_code_alt"></p>
                    </div>
                    <div class="setup-guide-unified">
                        <!-- Method 1: WiFi -->
                        <div class="setup-unified-item">
                            <svg class="setup-graphic-svg" viewBox="0 0 200 85" style="height: 70px;">
                                <path transform="translate(88, 10) scale(1)" fill="var(--primary)"
                                    d="M1 9l2 2c4.97-4.97 13.03-4.97 18 0l2-2C16.93 2.93 7.08 2.93 1 9zm8 8l3 3 3-3c-1.65-1.66-4.34-1.66-6 0zm-4-4l2 2c2.76-2.76 7.24-2.76 10 0l2-2C15.14 9.14 8.87 9.14 5 13z" />
                                <line x1="100" y1="36" x2="65" y2="55" class="graphic-line-active"
                                    stroke-opacity="0.5" />
                                <line x1="100" y1="36" x2="135" y2="55" class="graphic-line-active"
                                    stroke-opacity="0.5" />
                                <rect x="57" y="50" width="16" height="20" rx="3" class="graphic-device" />
                                <rect x="127" y="50" width="16" height="20" rx="3" class="graphic-device"
                                    style="stroke:var(--primary); stroke-width:2;" />
                            </svg>
                            <div class="setup-inner-desc" data-i18n="help.connect_all_wifi"></div>
                        </div>

                        <!-- Method 2: Hotspot -->
                        <div class="setup-unified-item">
                            <svg class="setup-graphic-svg" viewBox="0 0 200 85" style="height: 70px;">
                                <g transform="translate(0, 5)">
                                    <rect x="50" y="25" width="18" height="30" rx="3" class="graphic-device" />
                                    <path d="M75 40 h50" class="graphic-line-active" />
                                    <rect x="132" y="25" width="18" height="30" rx="3" class="graphic-device"
                                        style="stroke:var(--primary); stroke-width:2;" />
                                    <text x="45" y="70" class="graphic-text" style="font-size: 10px;">HOST</text>
                                    <text x="125" y="70" class="graphic-text" fill="var(--primary)"
                                        style="font-size: 10px;">GUEST</text>
                                </g>
                            </svg>
                            <div class="setup-inner-desc" data-i18n="help.wifi_hotspot"></div>
                        </div>
                    </div>

                    <div class="setup-code-area-bottom">
                        <div class="setup-code-label" data-i18n="setup.enter_host_code"></div>
                        <input type="text" class="setup-join-input" id="setup-join-code" placeholder="000000"
                            inputmode="numeric" pattern="[0-9]*" maxlength="6" autocomplete="one-time-code"
                            enterkeyhint="done" autocapitalize="off" autocorrect="off" spellcheck="false"
                            aria-label="" data-i18n-aria-label="setup.enter_code">
                    </div>
                </div>

                <!-- Host/Guest: Role selection -->
                <div id="setup-role-area" style="display:none; width:100%; position: relative;">

                    <div class="setup-header-text">
                        <h2 data-i18n="setup.what_sound"></h2>
                        <p data-i18n="setup.change_later"></p>
                    </div>

                    <div class="setup-graphic-container"
                        style="height: auto; aspect-ratio: 2.2; margin-bottom: 24px; background: transparent; max-height: 180px; margin-left: -28px; margin-right: -28px; width: calc(100% + 56px);">
                        <svg class="setup-graphic-svg" viewBox="0 0 340 170" style="overflow:visible;">
                            <defs>
                                <linearGradient id="grad-tl" x1="1" y1="1" x2="0" y2="0">
                                    <stop offset="0%" stop-color="var(--text-muted)" stop-opacity="1" />
                                    <stop offset="100%" stop-color="var(--text-muted)" stop-opacity="0" />
                                </linearGradient>
                                <linearGradient id="grad-tr" x1="0" y1="1" x2="1" y2="0">
                                    <stop offset="0%" stop-color="var(--text-muted)" stop-opacity="1" />
                                    <stop offset="100%" stop-color="var(--text-muted)" stop-opacity="0" />
                                </linearGradient>
                                <linearGradient id="grad-br" x1="0" y1="0" x2="1" y2="1">
                                    <stop offset="0%" stop-color="var(--text-muted)" stop-opacity="1" />
                                    <stop offset="100%" stop-color="var(--text-muted)" stop-opacity="0" />
                                </linearGradient>
                                <linearGradient id="grad-bl" x1="1" y1="0" x2="0" y2="1">
                                    <stop offset="0%" stop-color="var(--text-muted)" stop-opacity="1" />
                                    <stop offset="100%" stop-color="var(--text-muted)" stop-opacity="0" />
                                </linearGradient>
                            </defs>
                            <!-- Room Perspective -->
                            <g class="graphic-room">
                                <!-- Back Wall (Solid) -->
                                <rect x="40" y="30" width="260" height="90" />
                                <!-- Corner Lines (Gradients) -->
                                <line x1="40" y1="30" x2="0" y2="0" stroke="url(#grad-tl)" />
                                <line x1="300" y1="30" x2="340" y2="0" stroke="url(#grad-tr)" />
                                <line x1="300" y1="120" x2="340" y2="170" stroke="url(#grad-br)" />
                                <line x1="40" y1="120" x2="0" y2="170" stroke="url(#grad-bl)" />
                            </g>

                            <!-- TV (Decor) -->
                            <rect class="graphic-tv" x="115" y="38" width="110" height="62" rx="2" />

                            <!-- Listener Removed -->

                            <!-- Speakers (Larger Size) -->
                            <!-- FL (Front Left) -->
                            <g id="svg-spk-l" class="graphic-speaker">
                                <!-- Cabinet -->
                                <rect x="50" y="60" width="20" height="68" rx="2" />
                                <!-- Drivers -->
                                <circle cx="60" cy="75" r="3.5" class="spk-driver" />
                                <circle cx="60" cy="92" r="4.5" class="spk-driver" />
                                <circle cx="60" cy="112" r="4.5" class="spk-driver" />
                                <!-- Base -->
                                <rect x="49" y="128" width="22" height="3" rx="1"
                                    style="fill:var(--text-sub); stroke:none; opacity:0.5;" />
                            </g>

                            <!-- FR (Front Right) -->
                            <g id="svg-spk-r" class="graphic-speaker">
                                <!-- Cabinet -->
                                <rect x="272" y="60" width="20" height="68" rx="2" />
                                <!-- Drivers -->
                                <circle cx="282" cy="75" r="3.5" class="spk-driver" />
                                <circle cx="282" cy="92" r="4.5" class="spk-driver" />
                                <circle cx="282" cy="112" r="4.5" class="spk-driver" />
                                <!-- Base -->
                                <rect x="271" y="128" width="22" height="3" rx="1"
                                    style="fill:var(--text-sub); stroke:none; opacity:0.5;" />
                            </g>

                            <!-- Center (C) -->
                            <g id="svg-spk-center" class="graphic-speaker">
                                <!-- Feet -->
                                <rect x="155" y="140" width="4" height="3"
                                    style="fill:var(--text-sub); stroke:none; opacity:0.8;" />
                                <rect x="181" y="140" width="4" height="3"
                                    style="fill:var(--text-sub); stroke:none; opacity:0.8;" />
                                <!-- Cabinet -->
                                <rect x="145" y="125" width="50" height="15" rx="2" />
                                <circle cx="170" cy="132.5" r="3.5" class="spk-driver" />
                                <circle cx="155" cy="132.5" r="4" class="spk-driver" />
                                <circle cx="185" cy="132.5" r="4" class="spk-driver" />
                            </g>

                            <!-- Woofer (SW) -->
                            <g id="svg-spk-woofer" class="graphic-speaker">
                                <!-- Feet -->
                                <rect x="111" y="140" width="4" height="3"
                                    style="fill:var(--text-sub); stroke:none; opacity:0.8;" />
                                <rect x="133" y="140" width="4" height="3"
                                    style="fill:var(--text-sub); stroke:none; opacity:0.8;" />
                                <!-- Cabinet -->
                                <rect x="108" y="108" width="32" height="32" rx="3" />
                                <!-- Driver -->
                                <circle cx="124" cy="124" r="9" class="spk-driver"
                                    style="stroke:var(--surface-3); stroke-width:1;" />
                            </g>
                        </svg>
                    </div>
                    <div class="channel-grid" id="setup-role-grid" style="padding: 0; margin-top: 0;">
                        <div class="ch-opt" data-join-ch="-1">
                            <svg viewBox="0 0 24 24">
                                <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" />
                            </svg>
                            <span data-i18n="role.left"></span>
                        </div>
                        <div class="ch-opt" data-join-ch="1">
                            <svg viewBox="0 0 24 24">
                                <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z" />
                            </svg>
                            <span data-i18n="role.right"></span>
                        </div>
                        <div class="ch-opt" data-join-ch="2">
                            <svg viewBox="0 0 24 24">
                                <path
                                    d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z" />
                                <circle cx="12" cy="12" r="3" />
                            </svg>
                            <span data-i18n="role.subwoofer"></span>
                        </div>
                        <div class="ch-opt" data-join-ch="0">
                            <svg viewBox="0 0 24 24">
                                <path
                                    d="M12 3v9.28c-.47-.17-.97-.28-1.5-.28C8.01 12 6 14.01 6 16.5S8.01 21 10.5 21c2.31 0 4.16-1.75 4.45-4H15V6h4V3h-7z" />
                            </svg>
                            <span data-i18n="role.center"></span>
                        </div>
                    </div>
                </div>

                <div class="ob-actions" id="setup-actions">
                    <!-- JS will populate -->
                </div>
            </div> <!-- End of .setup-mobile-view -->
        </div>
    </div>


    <!-- App Dialog (Non-blocking, replaces alert()) -->
    <div class="dialog-overlay" id="dialog-overlay" aria-hidden="true">
        <div class="dialog" role="dialog" aria-modal="true" aria-labelledby="dialog-title"
            aria-describedby="dialog-message">
            <div class="dialog-header">
                <span class="dialog-title" id="dialog-title" data-i18n="common.info"></span>
                <button type="button" class="dialog-close" id="btn-dialog-close" aria-label="" data-i18n-aria-label="common.close">
                    <svg viewBox="0 0 24 24" aria-hidden="true">
                        <path
                            d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
                    </svg>
                </button>
            </div>
            <div class="dialog-message" id="dialog-message"></div>
            <div class="dialog-actions">
                <button type="button" class="dialog-secondary" id="btn-dialog-secondary"
                    style="display:none" data-i18n="common.cancel"></button>
                <button type="button" class="dialog-primary" id="btn-dialog-ok" data-i18n="common.ok"></button>
            </div>
        </div>
    </div>

    <div class="toast" id="toast" role="status" aria-live="polite" aria-atomic="true"><span id="toast-msg" data-i18n="common.message"></span>
    </div>

    <!-- Manual Sync Overlay (Bug #1: was missing from HTML) -->
    <div class="manual-sync-overlay" id="manual-sync-overlay">
        <div class="sync-glass-panel">
            <div class="sync-card-title" data-i18n="player.manual_sync_title"></div>
            <div class="sync-status-text" id="manual-sync-value">0</div>
            <div style="display:flex; gap:8px; justify-content:center; margin:16px 0;">
                <button class="btn-action" id="btn-nudge-minus10" style="flex:1;">-10ms</button>
                <button class="btn-action" id="btn-nudge-minus1" style="flex:1;">-1ms</button>
                <button class="btn-action" id="btn-nudge-plus1" style="flex:1;">+1ms</button>
                <button class="btn-action" id="btn-nudge-plus10" style="flex:1;">+10ms</button>
            </div>
            <div style="display:flex; gap:8px; margin-top:12px;">
                <button class="btn-action" id="btn-auto-sync" style="flex:1;" data-i18n="common.reset"></button>
                <button class="btn-ob-primary" id="btn-sync-done" style="flex:1;" data-i18n="common.done"></button>
            </div>
        </div>
    </div>

    <div id="media-source-overlay" class="onboarding-overlay">
        <div class="onboarding-card setup-card full-screen">

            <div class="setup-header-text">
                <h2 data-i18n="player.select_media"></h2>
                <p data-i18n="help.media_synced_detail"></p>
            </div>

            <div class="setup-slot-list">
                <button class="file-select-btn" id="btn-local-file">
                    <div class="btn-icon-bg">
                        <svg viewBox="0 0 24 24">
                            <path d="M9 16h6v-6h4l-7-7-7 7h4zm-4 2h14v2H5z" />
                        </svg>
                    </div>
                    <span data-i18n="help.load_local"></span>
                </button>
                <button class="file-select-btn" id="btn-youtube-source">
                    <div class="btn-icon-bg youtube">
                        <svg viewBox="0 0 24 24">
                            <path
                                d="M10 15l5.19-3L10 9v6m11.56-7.83c.13.47.22 1.1.28 1.9.07.8.1 1.49.1 2.09L22 12c0 2.19-.16 3.8-.44 4.83-.25.9-.83 1.48-1.73 1.73-.47.13-1.33.22-2.65.28-1.3.07-2.49.1-3.59.1L12 19c-4.19 0-6.8-.16-7.83-.44-.9-.25-1.48-.83-1.73-1.73-.13-.47-.22-1.1-.28-1.9-.07-.8-.1-1.49-.1-2.09L2 12c0-2.19.16-3.8.44-4.83.25-.9.83-1.48 1.73-1.73.47-.13 1.33-.22 2.65-.28 1.3-.07 2.49-.1 3.59-.1L12 5c4.19 0 6.8.16 7.83.44.9.25 1.48.83 1.73 1.73z" />
                        </svg>
                    </div>
                    <span data-i18n="help.youtube_compat"></span>
                </button>
                <button class="file-select-btn" id="btn-demo-media">
                    <div class="btn-icon-bg">
                        <svg viewBox="0 0 24 24">
                            <path
                                d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-8 12.5v-9l6 4.5-6 4.5z" />
                        </svg>
                    </div>
                    <span data-i18n="setup.demo_button"></span>
                </button>
            </div>

            <div class="ob-actions">
                <button class="btn-ob-secondary" id="btn-close-media-popup" style="flex: 1;" data-i18n="common.close"></button>
            </div>
        </div>
    </div>

    <div id="youtube-url-overlay" class="onboarding-overlay">
        <div class="onboarding-card setup-card full-screen">


            <div class="setup-header-text">
                <h2 data-i18n="youtube.watch_together"></h2>
                <p data-i18n-html="youtube.enter_link_desc_html"></p>
            </div>

            <div class="setup-join-area" style="margin-top: 0;">
                <input type="text" id="youtube-url-input" class="setup-join-input" placeholder="https://youtube.com/..."
                    aria-label="" data-i18n-aria-label="youtube.enter_link"
                    style="font-size: 15px; font-weight: 500; letter-spacing: normal; padding: 12px 0;">

                <div id="youtube-preview"
                    style="display:none; background:var(--surface-2); border-radius:16px; padding:12px; gap:12px;">
                    <img id="youtube-preview-thumb" src="" alt="" data-i18n-alt="youtube.thumbnail"
                        style="width:100%; border-radius:10px; aspect-ratio:16/9; object-fit:cover; background:#000;">
                    <div style="margin-top:8px;">
                        <p id="youtube-preview-title"
                            style="font-size:13px; font-weight:700; color:var(--text-main); margin:0; line-height:1.4;">
                        </p>
                        <p id="youtube-preview-channel"
                            style="font-size:11px; color:var(--text-sub); margin:4px 0 0 0;"></p>
                    </div>
                </div>

                <p id="youtube-preview-status"
                    style="font-size:11px; color:var(--text-sub); text-align:center; margin:4px 0 0 0; font-weight: 600;"
                    data-i18n="youtube.enter_link_prompt">
                </p>
            </div>

            <div class="ob-actions" style="margin-top: 8px; display: flex; gap: 10px;">
                <button class="btn-ob-secondary" id="btn-yt-cancel" style="flex: 1;" data-i18n="common.cancel"></button>
                <button id="youtube-play-btn" class="btn-ob-primary" disabled style="flex: 1.5; opacity: 0.5;" data-i18n="player.play_start"></button>
            </div>
        </div>
    </div>

    <script type="module" src="/src/app.ts"></script>
</body>

</html>