/* ==========================================================================
   Desktop / Tablet Responsive Dashboard Layout (Premium 4-Column Design)
   Active on screens wider than 1280px.
   Layout: [ Play (Main) ] | [ Chat ] | [ Playlist ] | [ Settings ]
   ========================================================================== */

@layer desktop {
@media (min-width: 1280px) {

    /* ---------------------------------------------------
       1. Application Base Grid
       --------------------------------------------------- */
    body {
        display: grid;
        grid-template-columns: 1fr 420px 420px;
        grid-template-rows: var(--header-height) 1fr 1fr;
        grid-template-areas:
            "header header header"
            "tab-play tab-playlist tab-settings"
            "tab-play tab-chat tab-settings";
        gap: 0;
        /* Gaps emulated through panel paddings so vertical dividers function cleanly */
        padding-bottom: 0;
        padding-right: 24px;
        padding-left: 24px;
        background: var(--bg);
        /* Deepest background for the outer space */
        overflow: hidden;
        /* Use JS-measured visible viewport height when available.
           Prevents clipping on Android tablets where 100vh may include the
           area behind the system navigation bar (esp. landscape / PWA). */
        height: var(--app-height, 100vh);
        max-height: var(--app-height, 100vh);
    }

    header {
        grid-area: header;
        position: relative;
        width: 100vw;
        margin-left: -24px;
        /* Offset the body's padding-left */
        padding-left: 24px;
        padding-right: 24px;
        box-sizing: border-box;
        box-shadow: none;
        background: var(--glass-bg);
        border-bottom: none;
        /* Seamless header */
        margin-bottom: 0;
        /* Stopped underlap */
    }

    /* ---------------------------------------------------
       2. Hide Mobile Elements
       --------------------------------------------------- */
    .bottom-nav,
    .nav-blur-halo,
    .bottom-nav::before {
        display: none;
    }

    #btn-chat-close,
    #chat-preview-btn {
        display: none;
    }

    /* ---------------------------------------------------
       3. Shared Panel Styles
       --------------------------------------------------- */
    #tab-play,
    .chat-drawer,
    #tab-playlist,
    #tab-settings,
    #tab-guide {
        padding-top: 0;
        /* Panels have internal headers now */
        display: flex;
        flex-direction: column;
        /* Vertical column layout */
        opacity: 1;
        visibility: visible;
        pointer-events: auto;
        position: relative;
        transform: none;
        height: 100%;
        top: 0;
        left: 0;
        width: 100%;

        background: transparent;
        border-radius: 0;
        border: none;
        box-shadow: none;
        overflow: hidden;
        /* Parent NO LONGER scrolls */
    }

    /* New Scrolling Architecture: Bodies handle the scroll */
    .tab-body,
    .chat-drawer-messages {
        flex: 1;
        overflow-y: auto;
        padding-bottom: 40px;
        scrollbar-gutter: stable;
        /* Prevent layout shift */
    }

    #tab-play .tab-body {
        padding-bottom: 0;
    }

    /* Push controls to the bottom, matching the overlay's .ob-actions structure:
       margin-top: auto + padding-bottom on the DIRECT container */
    #tab-play .controls-area {
        margin-top: auto;
        margin-bottom: 0;
        padding-bottom: 40px;
    }

    /* Panel Headers: Fixed at the top, No Background Mask needed anymore! */
    .tab-header,
    .chat-drawer-header {
        flex: none;
        padding: 32px 32px 16px;
        position: relative;
        /* No longer sticky */
        background: transparent;
        z-index: 10;
        border-bottom: none;
        margin-bottom: 0;
    }

    /* Harmonize Header Typographies (Title, Menu, Chat, etc) */
    .tab-title,
    .chat-drawer-title,
    .track-title {
        font-size: 24px;
        /* Beautifully unified and properly proportioned */
        font-weight: 800;
        letter-spacing: -0.02em;
        color: var(--text-main);
    }

    /* ---------------------------------------------------
       4. Specific Panel: Play (Main)
       --------------------------------------------------- */
    #tab-play {
        grid-area: tab-play;
        flex-direction: column;
        justify-content: flex-start;
        align-items: center;
        padding: 0 0 0 8px;
        border-right: 1px solid var(--divider);
        min-width: 0;
        min-height: 0;
        max-width: 100%;
        gap: 16px;
        overflow-y: auto;
        overflow-x: hidden;
    }

    #tab-playlist {
        padding: 0 0 0 8px;
        border-right: 1px solid var(--divider);
        border-bottom: 1px solid var(--divider);
    }

    .chat-drawer {
        padding: 0;
        border-right: 1px solid var(--divider);
        background: transparent;
        box-shadow: none;
    }

    #tab-settings {
        padding: 0 0 0 8px;
    }

    .play-header-desktop {
        display: none;
    }

    .play-action-buttons {
        position: relative;
        bottom: auto;
        left: auto;
        right: auto;
        width: 100%;
        max-width: calc(100% - 80px);
        margin-left: auto;
        margin-right: auto;
        gap: 12px;
        margin-top: auto;
        /* Pushes to bottom of flex column naturally */
        padding-bottom: 0px;
        flex-shrink: 0;
        justify-content: center;
    }

    .play-action-buttons .file-select-btn-large {
        padding: 24px 20px;
        font-size: 16px;
    }

    .vinyl-wrapper {
        width: clamp(160px, min(22vw, 30vh), 320px);
        height: clamp(160px, min(22vw, 30vh), 320px);
        margin-top: auto;
        margin-bottom: 0;
    }

    .video-wrapper {
        width: 100%;
        /* Prevent infinite scaling on wide monitors, also respect vertical space for controls */
        max-width: min(90%, 1080px, calc((100vh - 360px) * 16 / 9));
        /* Center vertically in remaining space above controls (like visualizer) */
        margin: auto auto 0 auto;
        border-radius: 20px;
        box-shadow: none;
    }

    /* Play Controller adjustments */
    .controls-area {
        max-width: 100%;
        padding: 0 32px;
        margin-top: auto;
        flex-grow: 0;
        padding-bottom: 32px;
    }

    .play-controls-left {
        margin-bottom: 24px;
    }

    /* ---------------------------------------------------
       5. Specific Panel: Chat
       --------------------------------------------------- */
    .chat-drawer {
        grid-area: tab-chat;
    }

    /* ---------------------------------------------------
       6. Specific Panel: Playlist
       --------------------------------------------------- */
    #tab-playlist {
        grid-area: tab-playlist;
    }

    /* ---------------------------------------------------
       7. Specific Panel: Settings
       --------------------------------------------------- */
    #tab-settings {
        grid-area: tab-settings;
        /* Padding bottom is handled by .tab-content style above */
    }

    /* ---------------------------------------------------
       8. Guide (도움말 화면)
       --------------------------------------------------- */
    #tab-guide {
        display: none;
    }

    /* ---------------------------------------------------
       9. Setup/Onboarding Overlay — Full-Width 2-Column Desktop Layout
       --------------------------------------------------- */
    #setup-overlay {
        position: fixed;
        inset: 0;
        z-index: 5000;
        background: var(--bg);
        backdrop-filter: none;
        -webkit-backdrop-filter: none;
    }

    #setup-overlay .setup-card.full-screen {
        position: fixed;
        inset: 0;
        width: 100vw;
        max-width: none;
        /* Same rationale as body: cap to the *visible* viewport height. */
        height: var(--app-height, 100vh);
        max-height: var(--app-height, 100vh);
        border-radius: 0;
        border: none;
        outline: none;
        box-shadow: none;
        background: transparent;
        padding: 0;
        transform: none;
        display: grid;
        grid-template-columns: 1fr 480px;
        grid-template-rows: 1fr;
        overflow: hidden;
    }

    /* --- Left Column: Diagram area + step header --- */
    #setup-desktop-brand {
        display: flex;
        flex: 1;
        background: var(--bg);
        flex-direction: column;
        justify-content: flex-start;
        align-items: flex-start;
        text-align: left;
        padding: 0;
        color: white;
        position: relative;
        overflow: hidden;
    }

    /* Hide the static brand logo/tagline — replaced by dynamic step headers */
    #setup-desktop-brand .brand-content {
        display: none;
    }

    /* --- Desktop step header (mirrored into left panel by JS) --- */
    .desktop-step-header {
        display: block;
        padding: clamp(48px, 7vh, 80px) clamp(48px, 5vw, 80px) 0;
        width: 100%;
        z-index: 2;
    }

    .desktop-step-header h2 {
        font-size: clamp(22px, 2.4vw, 32px);
        font-weight: 800;
        letter-spacing: -0.03em;
        color: var(--text-main);
        margin-bottom: 8px;
        line-height: 1.2;
    }

    .desktop-step-header p {
        font-size: clamp(13px, 1.1vw, 16px);
        color: var(--text-sub);
        opacity: 0.55;
        line-height: 1.5;
    }

    /* --- Desktop diagram area (elements moved here by JS) --- */
    .desktop-diagram-area {
        display: flex;
        flex: 1;
        width: 100%;
        align-items: center;
        justify-content: center;
        padding: clamp(16px, 3vh, 40px) clamp(40px, 6vw, 100px);
        position: relative;
        overflow: visible;
    }

    /* --- Hide headers from the right panel (they're now mirrored to the left) --- */
    #setup-overlay .setup-mobile-view .setup-header-text {
        display: none;
    }

    /* --- Right Column: Interactive panel (vertically centered content) --- */
    #setup-overlay .setup-mobile-view {
        width: 480px;
        min-width: 480px;
        background: var(--surface-1);
        height: 100%;
        box-shadow: none;
        padding: 0;
        overflow-y: auto;
        scrollbar-gutter: stable;
        -ms-overflow-style: auto;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }

    #setup-overlay .setup-mobile-view::-webkit-scrollbar {
        width: 8px;
        height: 8px;
    }

    #setup-overlay .setup-mobile-view::-webkit-scrollbar-track {
        margin-top: 20px;
        margin-bottom: 20px;
        background: transparent;
    }

    #setup-overlay .setup-mobile-view::-webkit-scrollbar-thumb {
        background-color: var(--scrollbar-thumb);
        border: 2px solid transparent;
        border-radius: 10px;
        background-clip: padding-box;
    }

    #setup-overlay .setup-mobile-view::-webkit-scrollbar-thumb:hover {
        background-color: var(--scrollbar-thumb-hover);
    }

    #setup-overlay .setup-mobile-view::-webkit-scrollbar-thumb:active {
        background-color: var(--scrollbar-thumb-active);
    }

    /* --- Onboarding slider: enlarged when inside left panel --- */
    .desktop-diagram-area #ob-slider-area {
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }

    .desktop-diagram-area .ob-slider-viewport {
        width: clamp(320px, 60%, 560px);
    }

    .desktop-diagram-area .ob-nav-row {
        margin-top: 24px;
    }

    /* Enlarge onboarding icon circles for desktop */
    .desktop-diagram-area .ob-icon-circle {
        width: clamp(72px, 8vw, 100px);
        height: clamp(72px, 8vw, 100px);
    }

    .desktop-diagram-area .ob-icon-circle svg {
        width: clamp(32px, 3.5vw, 44px);
        height: clamp(32px, 3.5vw, 44px);
    }

    .desktop-diagram-area .ob-slide .ob-title {
        font-size: clamp(22px, 2.2vw, 28px);
    }

    .desktop-diagram-area .ob-slide .ob-desc {
        font-size: clamp(13px, 1.1vw, 15px);
    }

    /* Onboarding mini arrows — slightly larger on desktop */
    .ob-nav-arrow {
        width: 22px;
        height: 22px;
    }

    /* --- Role SVG diagram: enlarged in left panel --- */
    .desktop-diagram-area .setup-graphic-container {
        width: 100%;
        max-width: none;
        max-height: none;
        height: auto;
        min-height: 0;
        margin: 0;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .desktop-diagram-area .setup-graphic-svg {
        max-width: clamp(480px, 60vw, 780px);
        width: 100%;
        height: auto;
    }

    /* --- Network guide diagrams: enlarged in left panel --- */
    .desktop-diagram-area .setup-guide-unified {
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: clamp(40px, 6vh, 72px);
        margin: 0;
    }

    .desktop-diagram-area .setup-guide-unified .setup-graphic-svg {
        max-width: clamp(420px, 55vw, 680px);
        height: clamp(100px, 16vh, 200px);
    }

    .desktop-diagram-area .setup-unified-item .setup-inner-desc {
        font-size: clamp(14px, 1.3vw, 18px);
    }

    /* --- Actions bar pinned to bottom of right column --- */
    #setup-overlay .setup-mobile-view .ob-actions {
        background: var(--surface-1);
        padding-left: 44px;
        padding-right: 36px;
        /* 44 left + 36 right + 8 scrollbar-gutter = symmetric 44px visual gap each side */
        padding-bottom: 40px;
        padding-top: 16px;
        border-top: none;
        margin-top: auto;
        flex-shrink: 0;
    }

    /* --- Right panel content areas: center vertically when visible --- */
    /* NOTE: These areas use inline style display:none/flex toggled by JS.
       We must NOT use display:flex here or it overrides JS hiding.
       Use flex properties only - they'll apply when JS sets display:flex. */
    #setup-overlay #setup-welcome-area,
    #setup-overlay #setup-code-area,
    #setup-overlay #setup-join-area,
    #setup-overlay #setup-role-area {
        flex: 1;
        flex-direction: column;
        justify-content: center;
        align-items: stretch;
    }

    /* --- Content padding inside right panel --- */
    /* Compensate scrollbar-gutter (8px right): 44 left + 36 right = symmetric 44px visual gap */
    .setup-mobile-view>div:not(.ob-actions, .setup-header-pill) {
        padding-left: 44px;
        padding-right: 36px;
    }

    /* Map media/youtube overlays into the main Play grid area instead of full-screen popups */
    #media-source-overlay,
    #youtube-url-overlay {
        position: relative;
        grid-area: tab-play;
        z-index: 5000;
        background: var(--bg);
        backdrop-filter: none;
        -webkit-backdrop-filter: none;
        border-right: 1px solid var(--divider);
        padding: 0;
        border-radius: 0;
        overflow-x: hidden;
        overflow-y: scroll;
        scrollbar-gutter: stable;
        -ms-overflow-style: auto;
        display: none;
        height: 100%;
        max-height: 100%;
        min-height: 0;
        min-width: 0;
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
        inset: auto;
    }

    #media-source-overlay.active,
    #youtube-url-overlay.active {
        display: flex;
        flex-direction: column;
    }

    #media-source-overlay::-webkit-scrollbar,
    #youtube-url-overlay::-webkit-scrollbar {
        width: 8px;
        height: 8px;
    }

    #media-source-overlay::-webkit-scrollbar-track,
    #youtube-url-overlay::-webkit-scrollbar-track {
        margin-top: 20px;
        margin-bottom: 20px;
        background: transparent;
    }

    #media-source-overlay::-webkit-scrollbar-thumb,
    #youtube-url-overlay::-webkit-scrollbar-thumb {
        background-color: rgba(255, 255, 255, 0.15);
        border: 2px solid transparent;
        border-radius: 10px;
        background-clip: padding-box;
    }

    #media-source-overlay::-webkit-scrollbar-thumb:hover,
    #youtube-url-overlay::-webkit-scrollbar-thumb:hover {
        background-color: rgba(255, 255, 255, 0.35);
    }

    #media-source-overlay::-webkit-scrollbar-thumb:active,
    #youtube-url-overlay::-webkit-scrollbar-thumb:active {
        background-color: rgba(255, 255, 255, 0.55);
    }

    #media-source-overlay .setup-card.full-screen,
    #youtube-url-overlay .setup-card.full-screen {
        position: relative;
        top: 0;
        left: 0;
        transform: none;
        width: 100%;
        height: auto;
        min-height: 100%;
        max-height: none;
        border-radius: 0;
        border: none;
        box-shadow: none;
        background: transparent;
        padding: 0;
        display: flex;
        flex-direction: column;
    }

    /* Prevent horizontal overflow from mobile inline CSS hacks */
    #setup-role-area .setup-graphic-container {
        margin-left: 0;
        margin-right: 0;
        width: 100%;
    }

    /* Wrap contents nicely and prevent them from shrinking weirdly */
    .setup-card.full-screen>* {
        flex-shrink: 0;
    }

    /* Padding for inner content (media/youtube overlays) */
    #media-source-overlay .setup-card.full-screen>div:not(.ob-actions),
    #youtube-url-overlay .setup-card.full-screen>div:not(.ob-actions) {
        padding-left: 40px;
        padding-right: 40px;
    }

    /* Override the mobile-specific padding dynamically but keep top/bottom */
    #media-source-overlay .setup-card.full-screen .ob-actions,
    #youtube-url-overlay .setup-card.full-screen .ob-actions {
        background: transparent;
        padding-left: 40px;
        padding-right: 40px;
        padding-bottom: 40px;
    }

    /* YouTube URL overlay: keep buttons always visible, let middle content scroll */
    #youtube-url-overlay .setup-card.full-screen {
        height: 100%;
        max-height: 100%;
        overflow: hidden;
    }

    #youtube-url-overlay .setup-card.full-screen .setup-join-area {
        flex: 1;
        min-height: 0;
        overflow-y: auto;
    }

    #youtube-url-overlay .setup-card.full-screen .ob-actions {
        flex-shrink: 0;
        margin-top: auto;
    }

    /* Limit preview thumbnail to avoid pushing buttons off-screen */
    #youtube-url-overlay #youtube-preview {
        max-height: calc(100vh - 420px);
        overflow-y: auto;
    }

    #youtube-url-overlay #youtube-preview-thumb {
        max-height: 40vh;
        width: 100%;
        object-fit: cover;
    }

    /* Tab text switching (Desktop) */
    .nav-text-desktop {
        display: inline;
    }

    .nav-text-mobile {
        display: none;
    }

    .desktop-help-section {
        display: block;
        margin-top: 32px;
    }

    button[data-tab="guide"] {
        display: none;
    }

    /* Completely Flatten Layout for Desktop (No boxes, no dividers) */
    .section-group {
        background: transparent;
        margin: 0 12px;
        box-shadow: none;
        border: none;
        border-radius: 0;
        border-bottom: 1px dotted var(--divider);
    }

    #tab-settings .channel-grid {
        padding: 12px 20px 12px;
        /* Standardized for desktop */
    }

    .section-header-row {
        border-bottom: none;
        padding: 44px 20px 16px;
        /* Symmetric 44px top start and 28px gap to content */
    }

    /* Role Selection: Match the default 44px top padding of other sections */
    #youtube-settings-disabled-wrap .section-group:first-of-type .section-header-row {
        padding-top: 44px;
    }

    .section-title {
        font-size: 17px;
        font-weight: 700;
        color: var(--text-main);
        text-transform: none;
        /* Remove uppercase if it was applied */
        letter-spacing: normal;
    }

    .slider-wrap {
        padding: 6px 20px;
    }

    /* Enforce 44px bottom gap on desktop too */
    .section-group>*:last-child {
        padding-bottom: 44px;
    }

    /* Align theme pill with section title on desktop */
    .theme-selector {
        margin-left: 20px;
        margin-right: 20px;
    }

    /* Align language pill with section title on desktop */
    .lang-selector {
        margin-left: 20px;
        margin-right: 20px;
    }

    /* Soften the settings text so title stands out */
    .slider-header {
        font-weight: 500;
        color: var(--text-sub);
        margin-bottom: 8px;
        /* Bring text closer to its own slider line */
    }

    .slider-header>span {
        color: var(--text-sub);
    }

    .slider-header .val-disp {
        font-weight: 700;
        color: var(--primary);
    }

    .help-block {
        background: transparent;
        margin: 0 16px 16px;
        padding: 16px;
        border: none;
        box-shadow: none;
    }

    .playlist-ul {
        margin: 0 16px;
    }

    /* Restore scrollbars for desktop bodies */
    .tab-body {
        -ms-overflow-style: auto;
        overflow-y: scroll;
        scrollbar-gutter: stable;
    }

    .tab-body::-webkit-scrollbar {
        width: 8px;
        height: 8px;
    }

    .tab-body::-webkit-scrollbar-track {
        margin-top: 10px;
        /* Reduced from 86px since it's now inside the body */
        margin-bottom: 20px;
        background: transparent;
    }

    .tab-body::-webkit-scrollbar-thumb {
        background-color: rgba(255, 255, 255, 0.15);
        border: 2px solid transparent;
        border-radius: 10px;
        background-clip: padding-box;
    }

    .tab-body::-webkit-scrollbar-thumb:hover {
        background-color: rgba(255, 255, 255, 0.35);
    }

    .tab-body::-webkit-scrollbar-thumb:active {
        background-color: rgba(255, 255, 255, 0.55);
    }

    /* Apply the exact same floaty scrollbar and layout-shift prevention to the Chat panel on Desktop, but without the 86px track margin because its header is outside the scroll area */
    .chat-drawer-messages {
        -ms-overflow-style: auto;
        overflow-y: scroll;
        scrollbar-gutter: stable;
        padding-left: 24px;
        /* 기본 여백 16px + 우측 투명 스크롤바 대칭용 물리적 여백 8px 추가 */
    }

    /* System messages: extend full-bleed accounting for asymmetric desktop padding (left 24px, right 16px) */
    .chat-group.system .chat-row {
        width: calc(100% + 40px);
        margin: 0 -16px 0 -24px;
    }

    .chat-drawer-messages::-webkit-scrollbar {
        width: 8px;
        height: 8px;
    }

    .chat-drawer-messages::-webkit-scrollbar-track {
        margin-bottom: 20px;
        background: transparent;
    }

    .chat-drawer-messages::-webkit-scrollbar-thumb {
        background-color: rgba(255, 255, 255, 0.15);
        border: 2px solid transparent;
        border-radius: 10px;
        background-clip: padding-box;
    }

    .chat-drawer-messages::-webkit-scrollbar-thumb:hover {
        background-color: rgba(255, 255, 255, 0.35);
    }

    .chat-drawer-messages::-webkit-scrollbar-thumb:active {
        background-color: rgba(255, 255, 255, 0.55);
    }

    /* Light mode: dark scrollbar thumbs on light background */
    [data-theme="light"] .tab-body::-webkit-scrollbar-thumb {
        background-color: rgba(0, 0, 0, 0.2);
    }

    [data-theme="light"] .tab-body::-webkit-scrollbar-thumb:hover {
        background-color: rgba(0, 0, 0, 0.4);
    }

    [data-theme="light"] .tab-body::-webkit-scrollbar-thumb:active {
        background-color: rgba(0, 0, 0, 0.6);
    }

    [data-theme="light"] .chat-drawer-messages::-webkit-scrollbar-thumb {
        background-color: rgba(0, 0, 0, 0.2);
    }

    [data-theme="light"] .chat-drawer-messages::-webkit-scrollbar-thumb:hover {
        background-color: rgba(0, 0, 0, 0.4);
    }

    [data-theme="light"] .chat-drawer-messages::-webkit-scrollbar-thumb:active {
        background-color: rgba(0, 0, 0, 0.6);
    }

    .track-item {
        border-bottom: none;
    }

    .chat-drawer-input {
        background: transparent;
    }

    /* Keep the action buttons consistently sized on all desktop viewports rather than full-width */
    .play-action-buttons {
        justify-content: center;
    }

    .play-action-buttons .file-select-btn {
        height: 60px;
        width: 160px;
        min-width: 160px;
        padding: 0 16px;
        border-radius: 20px;
        flex: none;
        /* Defeat inline style flex:1 from html */
        justify-content: center;
        align-items: center;
    }

    /* Bring back the text and align it nicely next to the icon */
    .play-action-buttons span {
        display: block;
        font-size: 14px;
        font-weight: 700;
    }

    /* Size the SVG icon correctly */
    .play-action-buttons .file-select-btn svg {
        width: 22px;
        height: 22px;
        margin: 0;
        margin-right: 8px;
        fill: var(--text-main);
    }
}
} /* end @layer desktop */