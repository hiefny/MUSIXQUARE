3:  * MUSIXQUARE - Multi-Device Synchronized Audio Player
29:  * player          : Tone.Player - 메인 오디오 플레이어
61:  * youtubePlayer   : YT.Player - YouTube IFrame Player
583:     // New Order: Player -> Widener -> Preamp -> Split -> (Channel Logic) -> Merge -> EQ -> Reverb -> Master
722:     // initAudio Checks if player exists, but calling it ensures setup
776: // --- Playlist & Player Logic ---
1019:             // 1. Try to get IDs from current player if it matches
2093:         // Streaming/No Buffer defaults to Center
2565:     // Determine buffer size
2616:             // High: 7.5kHz ~ 20kHz (0.7 ~ 1.0 of buffer)
2698:         // Add a small buffer (e.g., 32px) to ensure it clears the edge fully
2699:         const targetOffset = -(overflowWidth + 32); // +32 for padding/mask buffer
2757:         isActuallyPlaying = (player && player.state === 'started');
2783:         isActuallyPlaying = (player && player.state === 'started');
3177:                     // Send current time sync after short delay (let guest load player first)
3217:                             isActuallyPlaying = (player && player.state === 'started');
3246:                         isActuallyPlaying = (player && player.state === 'started');
3568: let latencyHistory = []; // Buffer to filter noise
3655:     // [FIX] Clear early chunks buffer to prevent data mixing
3794:                     if (hostConn && hostConn.open && (!buffer && !currentFileBlob)) {
3872:                         buffer = null;
3918:             window._pendingEarlyChunks = []; // Clear pending buffer
4076:     // CRITICAL: Clone the chunk! The underlying buffer might be reused or detached by PeerJS.
4097:         // [FIX] Buffer early chunks that arrive before file-start
4178:         buffer = null;
4351:     const isCurrentlyPlaying = (buffer || currentFileBlob) && (matchIndex(currentTrackIndex) || matchName(meta?.name));
4462:     console.log("[Preload] Success, saving to buffer cache");
4617:             const hasBuffer = (buffer && buffer.duration > 0);
4653:                         const alreadyGotIt = buffer || currentFileBlob || nextFileBlob;
4722:             const hasFile = (buffer && buffer.duration > 0) || (currentFileBlob && currentFileBlob.size > 0);
4953:             (currentState === APP_STATE.PLAYING_AUDIO ? (player && player.state === 'started') : (videoElement && !videoElement.paused)));
5195:                 console.log(`[Relay] Syncing preload buffer: ${preloadCount}/${preloadMeta.total} chunks`);
5571:                 console.warn("[Unicast] Buffer check failed, continuing:", bufferErr);
5662:             isActuallyPlaying = (player && player.state === 'started');
5669:             const duration = buffer ? buffer.duration : (hasVideoSrc ? videoElement.duration : 0);
5733:         buffer = null;
5912:     } else if (player) {
6053:     const miniPlayer = document.getElementById('yt-mini-player');
6116:             container.innerHTML = '<div class="chat-youtube-player" id="chat-youtube-placeholder"></div>';
6258:         container.innerHTML = '<div id="youtube-player"></div>';
6261:     if (!window.YT || !window.YT.Player) {
6290:     // [FIX] Safety Guard: Ensure we are still in YouTube mode when player initializes
6296:         console.log("[YouTube] Re-using existing player instance");
6311:             console.warn("[YouTube] Failed to reuse player, recreating...", e);
6313:             if (container) container.innerHTML = '<div id="youtube-player"></div>';
6344:     youtubePlayer = new YT.Player('youtube-player', playerOptions);
6348:     console.log("[YouTube] Player ready");
6363:     // [Sync] Apply current master volume to YouTube player immediately
6428:         // Player not ready yet
6528:         // Player not ready
6634:             console.log("[YouTube] Destroying player instance...");
6890: function audioBufferToWav(buffer) {
6891:     const numChannels = buffer.numberOfChannels;
6892:     const sampleRate = buffer.sampleRate;
6898:         result = interleave(buffer.getChannelData(0), buffer.getChannelData(1));
6900:         result = buffer.getChannelData(0);
6924:     const buffer = new ArrayBuffer(44 + samples.length * bytesPerSample);
6925:     const view = new DataView(buffer);
