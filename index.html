<!DOCTYPE html>
<html lang="ko" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
    <meta name="color-scheme" content="dark light">
    <meta name="theme-color" content="#0b0b10">
    <meta name="application-name" content="MUSIXQUARE">
    <meta name="apple-mobile-web-app-title" content="MUSIXQUARE">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    <meta property="og:title" content="MUSIXQUARE">
    <meta property="og:description" content="여러 기기를 연결하여 동기화된 서라운드 사운드를 만들어보세요. P2P 기반 실시간 오디오 동기화 웹앱.">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="MUSIXQUARE">
    <meta property="og:locale" content="ko_KR">
    <meta property="og:url" content="./">
    <meta property="og:image" content="icons/icon-512.png">
    <meta property="og:image:width" content="512">
    <meta property="og:image:height" content="512">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="MUSIXQUARE">
    <meta name="twitter:description" content="여러 기기를 연결하여 동기화된 서라운드 사운드를 만들어보세요. P2P 기반 실시간 오디오 동기화 웹앱.">
    <meta name="twitter:image" content="icons/icon-512.png">
    <title>MUSIXQUARE</title>
    <meta name="description" content="MUSIXQUARE - 여러 기기를 연결하여 동기화된 서라운드 사운드를 만들어보세요. P2P 기반 실시간 오디오 동기화 웹앱.">
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="manifest" href="manifest.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="icons/icon-180.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-32.png">
    <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192.png">
    <link rel="stylesheet" href="css/style.css">
    <script src="vendor/Tone.js"></script>
    <script src="vendor/peerjs.min.js"></script>
</head>

<body>

    <noscript>
        <div
            style="padding:16px; background:#111; color:#fff; font-family:system-ui, -apple-system, Segoe UI, Roboto, sans-serif;">
            MUSIXQUARE는 JavaScript가 필요합니다. 브라우저 설정에서 JavaScript를 활성화한 후 다시 시도하세요.
        </div>
    </noscript>

    <!-- Boot Splash: shown briefly on first launch before Setup overlay mounts -->
    <div id="boot-splash" class="boot-splash active" aria-hidden="false">
        <div class="boot-splash-inner" role="status" aria-live="polite">
            <div class="boot-splash-logo">MUSI<span class="logo-fade">XQUARE</span></div>
            <div class="boot-splash-spinner" aria-hidden="true"></div>
            <div class="boot-splash-text">준비 중…</div>
        </div>
    </div>


    <header id="main-header">
        <div class="header-progress-bg" id="header-progress-bg"></div>

        <div class="header-content-wrapper">
            <div class="app-logo header-default-content" id="app-logo" role="button" tabindex="0"
                aria-label="메인 화면으로 이동">MUSI<span class="logo-fade">XQUARE</span></div>
            <div class="header-loading-text" id="header-loading-text">Loading...</div>
        </div>

        <div class="header-right header-default-content">
            <div class="role-badge" id="role-badge">
                <div class="role-dot"></div>
                <span id="role-text">OFFLINE</span>
            </div>
        </div>
    </header>

    <div id="tab-play" class="tab-content active">
        <div class="vinyl-wrapper">
            <canvas id="visualizerCanvas" width="240" height="240"></canvas>

        </div>

        <div class="video-wrapper">
            <video id="main-video" class="video-screen" playsinline webkit-playsinline></video>
            <button class="fullscreen-btn" id="btn-fullscreen" aria-label="전체화면 전환">
                <svg viewBox="0 0 24 24">
                    <path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z" />
                </svg>
            </button>
        </div>

        <div class="track-box">
            <div class="track-title-wrapper">
                <div class="track-title" id="track-title">No Music</div>
            </div>
            <div class="track-artist" id="track-artist">Select a file or check Playlist</div>
        </div>

        <div class="controls-area">
            <div class="progress-bar">
                <input type="range" id="seek-slider" min="0" max="100" value="0" step="0.1" aria-label="재생 위치 조절">
                <div class="time-info">
                    <span id="time-curr">0:00</span>
                    <span id="time-dur">0:00</span>
                </div>
            </div>

            <div class="play-controls-left">
                <button class="ctrl-btn" id="btn-prev" aria-label="이전 트랙">
                    <svg viewBox="0 0 24 24">
                        <path d="M6 6h2v12H6zm3.5 6l8.5 6V6z" />
                    </svg>
                </button>
                <button class="play-fab" id="play-btn" aria-label="재생/일시정지" disabled>
                    <svg id="icon-play" viewBox="0 0 24 24">
                        <path d="M8 5v14l11-7z" />
                    </svg>
                    <svg id="icon-pause" viewBox="0 0 24 24" style="display:none">
                        <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z" />
                    </svg>
                </button>
                <button class="ctrl-btn" id="btn-next" aria-label="다음 트랙">
                    <svg viewBox="0 0 24 24">
                        <path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z" />
                    </svg>
                </button>

                <div class="vol-group-playback">
                    <svg id="vol-icon-btn" viewBox="0 0 24 24" style="cursor: pointer">
                        <path
                            d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z" />
                    </svg>
                    <input type="range" id="volume-slider" min="0" max="100" value="100" aria-label="볼륨 조절">
                </div>
            </div>

            <!-- Chat Preview Button -->
            <button type="button" class="chat-preview-btn" id="chat-preview-btn" aria-label="채팅 열기">
                <div class="chat-preview-left">
                    <svg viewBox="0 0 24 24" class="chat-preview-icon">
                        <path
                            d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z" />
                    </svg>
                    <span class="chat-preview-text" id="chat-preview-text">채팅을 시작하세요</span>
                </div>
                <span class="chat-preview-badge" id="chat-preview-badge"></span>
            </button>

            <!-- Buttons Row: SYNC (left) + Media (right) -->
            <div style="display:flex; gap:8px;">
                <button class="file-select-btn file-select-btn-large" id="btn-sync" style="flex:1;">
                    <svg viewBox="0 0 24 24">
                        <path
                            d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z" />
                    </svg>
                    <span>SYNC</span>
                </button>
                <button class="file-select-btn file-select-btn-large" id="btn-media-source" style="flex:1;">
                    <svg viewBox="0 0 24 24">
                        <path
                            d="M21 3H3c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H3V5h18v14zM9 8l7 4-7 4V8z" />
                    </svg>
                    <span>미디어 재생</span>
                </button>
            </div>

            <input type="file" id="file-input" multiple aria-label="로컬 파일 선택"
                accept=".mp3, .wav, .ogg, .m4a, .mp4, .webm, .mkv, audio/*, video/*" style="display:none">
        </div>
    </div>

    <div id="tab-playlist" class="tab-content">
        <div class="tab-header">
            <span class="tab-title">Playlist</span>
            <div class="playlist-title-area">
                <button class="tab-action-btn" id="btn-repeat" aria-label="반복 모드 변경">
                    <svg viewBox="0 0 24 24">
                        <path d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z" />
                    </svg>
                </button>
                <button class="tab-action-btn" id="btn-shuffle" aria-label="셔플 모드 변경">
                    <svg viewBox="0 0 24 24">
                        <path
                            d="M10.59 9.17L5.41 4 4 5.41l5.17 5.17 1.42-1.41zM14.5 4l2.04 2.04L4 18.59 5.41 20 17.96 7.46 20 9.5V4h-5.5zm.33 9.41l-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04 2.04-3.13-3.13z" />
                    </svg>
                </button>
                <button class="tab-action-btn" id="btn-add-media" aria-label="미디어 추가">
                    <svg viewBox="0 0 24 24">
                        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                    </svg>
                </button>
            </div>
        </div>
        <ul class="playlist-ul" id="playlist-ui">
            <li style="color:var(--text-sub); font-size:14px; text-align:center; padding:40px 0;">Add music files to
                start.</li>
        </ul>
    </div>

    <div id="tab-guide" class="tab-content">
        <div class="tab-header" style="justify-content: space-between; align-items: flex-start;">
            <span class="tab-title">Help</span>
            <div class="settings-invite-wrapper invite-code-container"
                style="text-align: right; cursor: pointer; display: flex; flex-direction: column; align-items: flex-end; padding-top: 6px;"
                title="클릭하여 초대코드 복사">
                <div
                    style="font-size: 9px; font-weight: 700; color: var(--text-sub); letter-spacing: 0.1em; margin-bottom: 2px; text-align: right;">
                    INVITATION CODE</div>
                <span class="invite-code-value"
                    style="font-size: 16px; font-weight: 800; font-variant-numeric: tabular-nums; letter-spacing: 0.1em; text-align: right;">------</span>
            </div>
        </div>

        <div class="help-block">
            <div class="help-title">
                <svg viewBox="0 0 24 24">
                    <path
                        d="M1 9l2 2c4.97-4.97 13.03-4.97 18 0l2-2C16.93 2.93 7.08 2.93 1 9zm8 8l3 3 3-3c-1.65-1.66-4.34-1.66-6 0zm-4-4l2 2c2.76-2.76 7.24-2.76 10 0l2-2C15.14 9.14 8.87 9.14 5 13z" />
                </svg>
                로컬 네트워크 전용
            </div>
            <div class="help-desc">
                이 버전은 <strong>로컬(같은 Wi‑Fi/핫스팟)</strong>에서만 연결됩니다.<br>
                <ul class="help-list">
                    <li>모든 기기가 <strong>동일한 네트워크</strong>에 연결되어야 해요.</li>
                    <li>VPN/사내 보안망이 켜져 있으면 연결이 실패할 수 있어요.</li>
                    <li>연결이 안 되면: Wi‑Fi 재연결 → 앱 새로고침 순서로 확인해 주세요.</li>
                </ul>
            </div>
        </div>

        <div class="help-block">
            <div class="help-title">
                <svg viewBox="0 0 24 24">
                    <path
                        d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z" />
                </svg>
                연결 방식
            </div>
            <div class="help-desc">
                <strong>QR / 링크 공유 없이</strong>, 방장이 보여주는 <strong>6자리 코드</strong>를 입력해 연결합니다.
                <ul class="help-list">
                    <li><strong>방장:</strong> “제가 방장할래요” → 코드 확인 → “시작할래요!”</li>
                    <li><strong>참가자:</strong> “모임에 참여할래요” → 코드 입력 → 역할 선택(원본/왼쪽/오른쪽/저음)</li>
                    <li>연결 가능한 기기는 <strong>방장 제외 최대 3대</strong>입니다.</li>
                </ul>
            </div>
        </div>

        <div class="help-block">
            <div class="help-title">
                <svg viewBox="0 0 24 24">
                    <path
                        d="M17 2H7c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-5 2c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2zm0 16c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z" />
                </svg>
                스피커 역할
            </div>
            <div class="help-desc">
                참가자가 <strong>역할(출력 채널)</strong>을 선택합니다.
                <ul class="help-list">
                    <li><strong>원본 음원:</strong> 스테레오(기본) 출력</li>
                    <li><strong>왼쪽 소리:</strong> L 채널 출력</li>
                    <li><strong>오른쪽 소리:</strong> R 채널 출력</li>
                    <li><strong>저음 영역:</strong> 저역 믹스 출력</li>
                </ul>
                필요하면 <strong>Settings</strong>에서 역할(채널 모드)을 언제든 변경할 수 있어요.
            </div>
        </div>

        <div class="help-block">
            <div class="help-title">
                <svg viewBox="0 0 24 24">
                    <path d="M9 16h6v-6h4l-7-7-7 7h4zm-4 2h14v2H5z" />
                </svg>
                미디어 재생
            </div>
            <div class="help-desc">
                방장에게는 3가지 선택지가 표시됩니다.
                <ul class="help-list">
                    <li><strong>로컬파일 불러오기:</strong> 기기 파일에서 음악/영상을 선택</li>
                    <li><strong>유튜브(채널분리 미지원):</strong> 링크를 붙여넣어 재생 목록에 추가</li>
                    <li><strong>앱 체험하기:</strong> 데모 미디어로 프로그램 테스트</li>
                </ul>
                <button class="demo-btn" id="btn-demo-guide"
                    style="width:100%; margin-top:12px; justify-content:center;">
                    <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                        <path
                            d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-8 12.5v-9l6 4.5-6 4.5z" />
                    </svg>
                    앱 체험하기 (데모)
                </button>
            </div>
        </div>

        <div class="help-block">
            <div class="help-title">
                <svg viewBox="0 0 24 24">
                    <path
                        d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-.83.45-1.54 1.17-2.25l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z" />
                </svg>
                문제 해결
            </div>
            <div class="help-desc">
                <ul class="help-list">
                    <li><strong>코드를 입력했는데 연결이 안 돼요:</strong> 두 기기가 같은 네트워크인지 확인해보세요.</li>
                    <li><strong>연결이 끊겨요:</strong> 네트워크 품질이 낮을 수 있어요. 공유기 근처로 이동해보세요.</li>
                    <li><strong>소리가 안나와요:</strong> 시스템 무음 모드가 설정되어있을 수 있어요.</li>
                    <li><strong>기타 문의사항:</strong> musixentre@gmail.com</li>
                </ul>
            </div>
        </div>
    </div>

    <div id="tab-settings" class="tab-content">
        <div class="tab-header" style="justify-content: space-between; align-items: flex-start;">
            <span class="tab-title">Settings</span>
            <div class="settings-invite-wrapper invite-code-container"
                style="text-align: right; cursor: pointer; display: flex; flex-direction: column; align-items: flex-end; padding-top: 6px;"
                title="클릭하여 초대코드 복사">
                <div
                    style="font-size: 9px; font-weight: 700; color: var(--text-sub); letter-spacing: 0.1em; margin-bottom: 2px; text-align: right;">
                    INVITATION CODE</div>
                <span class="invite-code-value"
                    style="font-size: 16px; font-weight: 800; font-variant-numeric: tabular-nums; letter-spacing: 0.1em; text-align: right;">------</span>
            </div>
        </div>

        <div class="section-group">
            <div class="section-header-row">
                <span class="section-title">Theme</span>
            </div>
            <div class="theme-selector">
                <div class="theme-opt" id="theme-light">Light</div>
                <div class="theme-opt" id="theme-dark">Dark</div>
                <div class="theme-opt" id="theme-system">System</div>
            </div>
        </div>

        <!-- YouTube mode notice (shown only while PLAYING_YOUTUBE) -->
        <div class="youtube-settings-note" id="youtube-settings-note" role="note">
            YouTube 함께보기 모드에서는 역할 설정과 고급 음향효과가 비활성화됩니다.
        </div>

        <!-- Everything below (except Theme) will be blurred/disabled in YouTube mode -->
        <div id="youtube-settings-disabled-wrap">

        <div class="section-group">
            <div class="section-header-row">
                <span class="section-title">Channel Mode & Subwoofer (Local)</span>
            </div>

            <!-- Standard Channel Grid (Stereo/L/R/Woofer) -->
            <div class="channel-grid" id="grid-standard" style="padding: 10px 20px 20px;">
                <div class="ch-opt" data-ch="-1">
                    <svg viewBox="0 0 24 24">
                        <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" />
                    </svg>Left
                </div>
                <div class="ch-opt" data-ch="1">
                    <svg viewBox="0 0 24 24">
                        <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z" />
                    </svg>Right
                </div>
                <div class="ch-opt" data-ch="0">
                    <svg viewBox="0 0 24 24">
                        <path
                            d="M12 3v9.28c-.47-.17-.97-.28-1.5-.28C8.01 12 6 14.01 6 16.5S8.01 21 10.5 21c2.31 0 4.16-1.75 4.45-4H15V6h4V3h-7z" />
                    </svg>Original
                </div>
                <div class="ch-opt" data-ch="2">
                    <svg viewBox="0 0 24 24">
                        <path
                            d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z" />
                        <circle cx="12" cy="12" r="3" />
                    </svg>Woofer
                </div>
            </div>

            <div class="slider-wrap" id="woofer-cutoff-control">
                <div class="slider-header">
                    <span>Subwoofer Cutoff (Local)</span>
                    <span class="val-disp" id="val-cutoff">120 Hz</span>
                </div>
                <input type="range" id="cutoff-slider" min="60" max="200" value="120" aria-label="서브우퍼 컷오프 주파수">
            </div>
        </div>

        <div class="section-group">
            <div class="section-header-row">
                <span class="section-title">Reverb (Host Synced)</span>
                <button class="btn-action" style="padding:4px 12px; height:28px; font-size:11px;"
                    id="btn-reset-reverb">Reset</button>
            </div>
            <div class="slider-wrap">
                <div class="slider-header">
                    <span>Mix <span
                            style="font-size:10px; color:var(--text-sub); font-weight:normal; margin-left:4px;">* 기본값
                            0%, 올리면 공간감 증가</span></span>
                    <span class="val-disp" id="val-reverb">0%</span>
                </div>
                <input type="range" id="reverb-slider" min="0" max="100" value="0" aria-label="리버브 믹스">
            </div>

            <!-- Decay Slider -->
            <div class="slider-wrap" style="padding-top:0;">
                <div class="slider-header">
                    <span>Decay Time <span
                            style="font-size:10px; color:var(--text-sub); font-weight:normal; margin-left:4px;">* 기본값
                            5.0s, 공간의 크기</span></span>
                    <span class="val-disp" id="val-rvb-decay">5.0s</span>
                </div>
                <input type="range" id="reverb-decay-slider" min="0.1" max="10.0" step="0.1" value="5.0"
                    aria-label="리버브 디케이 시간">
            </div>

            <!-- Pre-Delay Slider -->
            <div class="slider-wrap" style="padding-top:0;">
                <div class="slider-header">
                    <span>Bounce (Pre-Delay) <span
                            style="font-size:10px; color:var(--text-sub); font-weight:normal; margin-left:4px;">* 기본값
                            0.1s, 벽면 반사 지연</span></span>
                    <span class="val-disp" id="val-rvb-predelay">0.1s</span>
                </div>
                <input type="range" id="reverb-predelay-slider" min="0" max="0.5" step="0.01" value="0.1"
                    aria-label="리버브 프리딜레이">
            </div>

            <!-- Low Cut Slider (New) -->
            <div class="slider-wrap" style="padding-top:0;">
                <div class="slider-header">
                    <span>Low Cut <span
                            style="font-size:10px; color:var(--text-sub); font-weight:normal; margin-left:4px;">* 기본값
                            20Hz, 올리면 저음 컷(깔끔함)</span></span>
                    <span class="val-disp" id="val-rvb-lowcut">20Hz</span>
                </div>
                <input type="range" id="reverb-lowcut-slider" min="0" max="100" step="1" value="0" aria-label="리버브 로우컷">
            </div>

            <!-- High Cut Slider (New) -->
            <div class="slider-wrap" style="padding-top:0; padding-bottom:20px;">
                <div class="slider-header">
                    <span>High Cut <span
                            style="font-size:10px; color:var(--text-sub); font-weight:normal; margin-left:4px;">* 기본값
                            20.0k, 올리면 고음 컷(부드러움)</span></span>
                    <span class="val-disp" id="val-rvb-highcut">20.0k</span>
                </div>
                <input type="range" id="reverb-highcut-slider" min="0" max="100" step="1" value="0"
                    aria-label="리버브 하이컷">
            </div>
        </div>

        <!-- Graphic EQ Zone -->
        <div class="section-group">
            <div class="section-header-row">
                <span class="section-title">Graphic EQ (Host Synced)</span>
                <button class="btn-action" style="padding:4px 12px; height:28px; font-size:11px;"
                    id="btn-reset-eq">Reset</button>
            </div>

            <!-- Preamp (Inlined) -->
            <div class="slider-wrap" style="padding: 10px 20px 0; border-bottom: none;">
                <div class="slider-header">
                    <span style="font-size:11px; font-weight:700; color:var(--text-sub);">PREAMP</span>
                    <span class="val-disp" id="val-preamp" style="font-size:11px;">0dB</span>
                </div>
                <input type="range" id="preamp-slider" min="-12" max="12" value="0" aria-label="프리앰프 게인">
            </div>
            <div class="eq-container">
                <div class="eq-band">
                    <span class="eq-val" id="eq-val-0">0</span>
                    <input type="range" class="eq-slider" min="-12" max="12" value="0" id="eq-slider-0"
                        aria-label="EQ 60Hz">
                    <span class="eq-label">60</span>
                </div>
                <div class="eq-band">
                    <span class="eq-val" id="eq-val-1">0</span>
                    <input type="range" class="eq-slider" min="-12" max="12" value="0" id="eq-slider-1"
                        aria-label="EQ 230Hz">
                    <span class="eq-label">230</span>
                </div>
                <div class="eq-band">
                    <span class="eq-val" id="eq-val-2">0</span>
                    <input type="range" class="eq-slider" min="-12" max="12" value="0" id="eq-slider-2"
                        aria-label="EQ 910Hz">
                    <span class="eq-label">910</span>
                </div>
                <div class="eq-band">
                    <span class="eq-val" id="eq-val-3">0</span>
                    <input type="range" class="eq-slider" min="-12" max="12" value="0" id="eq-slider-3"
                        aria-label="EQ 3.6kHz">
                    <span class="eq-label">3.6k</span>
                </div>
                <div class="eq-band">
                    <span class="eq-val" id="eq-val-4">0</span>
                    <input type="range" class="eq-slider" min="-12" max="12" value="0" id="eq-slider-4"
                        aria-label="EQ 14kHz">
                    <span class="eq-label">14k</span>
                </div>
            </div>
        </div>

        <!-- Virtual Ste.. Surround Zone -->
        <div class="section-group">
            <div class="section-header-row">
                <span class="section-title">Virtual Surround (Host Synced)</span>
            </div>
            <div class="slider-wrap">
                <div class="slider-header">
                    <span>Width <span
                            style="font-size:10px; color:var(--text-sub); font-weight:normal; margin-left:4px;">* 기본값
                            100, 줄이면 모노, 늘리면 서라운드</span></span>
                    <span class="val-disp" id="val-width">100%</span>
                </div>
                <input type="range" id="width-slider" min="0" max="200" value="100" aria-label="스테레오 폭(서라운드) 조절">
            </div>
        </div>

        <div class="section-group">
            <div class="section-header-row">
                <span class="section-title">Virtual Bass (Host Synced)</span>
            </div>
            <div class="slider-wrap">
                <div class="slider-header">
                    <span>Level <span
                            style="font-size:10px; color:var(--text-sub); font-weight:normal; margin-left:4px;">* 기본값 0,
                            늘리면 가상 베이스(왜곡 증가)</span></span>
                    <span class="val-disp" id="val-vbass">0%</span>
                </div>
                <input type="range" id="vbass-slider" min="0" max="100" value="0" aria-label="가상 베이스 레벨">
            </div>
        </div>

        </div>
    </div>


    <!-- Slide-up Chat Drawer -->
    <div class="chat-drawer" id="chat-drawer">
        <div class="chat-drawer-header">
            <span class="chat-drawer-title">Chat</span>
            <button class="chat-drawer-close" id="btn-chat-close" aria-label="채팅 닫기">
                <svg viewBox="0 0 24 24">
                    <path
                        d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
                </svg>
            </button>
        </div>
        <div class="chat-drawer-messages" id="chat-messages">
            <div class="chat-empty">메시지가 없습니다.<br>첫 메시지를 보내보세요!</div>
        </div>
        <div class="chat-drawer-input">
            <input type="text" class="chat-input" id="chat-input" placeholder="메시지 입력..." maxlength="200"
                aria-label="채팅 메시지 입력">
            <button class="chat-send-btn" id="btn-chat-send" aria-label="메시지 보내기">
                <svg viewBox="0 0 24 24">
                    <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z" />
                </svg>
            </button>
        </div>
    </div>

    <nav class="bottom-nav">
        <button class="nav-item active" data-tab="play">
            <svg viewBox="0 0 24 24">
                <path
                    d="M12 3v9.28c-.47-.17-.97-.28-1.5-.28C8.01 12 6 14.01 6 16.5S8.01 21 10.5 21c2.31 0 4.16-1.75 4.45-4H15V6h4V3h-7z" />
            </svg>
            <span>Play</span>
        </button>
        <button class="nav-item" data-tab="playlist">
            <svg viewBox="0 0 24 24">
                <path
                    d="M15 6H3v2h12V6zm0 4H3v2h12v-2zM3 16h8v-2H3v2zM17 6v8.18c-.31-.11-.65-.18-1-.18-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3V8h3V6h-5z" />
            </svg>
            <span>Playlist</span>
        </button>
        <button class="nav-item" data-tab="settings">
            <svg viewBox="0 0 24 24">
                <path
                    d="M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z" />
            </svg>
            <span>Settings</span>
        </button>
        <button class="nav-item" data-tab="guide">
            <svg viewBox="0 0 24 24">
                <path
                    d="M11 18h2v-2h-2v2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4z" />
            </svg>
            <span>Help</span>
        </button>
    </nav>

    <audio id="silent-trigger" src="dummy_audio.mp3" preload="auto" x-webkit-airplay="allow" playsinline
        webkit-playsinline loop></audio>

    <div id="setup-overlay" class="onboarding-overlay">
        <div class="onboarding-card setup-card">
            <div class="setup-note" id="setup-note" style="display:block; margin-bottom: 8px;">
                <strong>로컬 네트워크 전용</strong><br>
                모든 기기가 <strong>같은 Wi‑Fi/핫스팟</strong>에 연결되어야 해요.
            </div>

            <div id="ob-slider-area" style="display:block; width:100%; position: relative;">
                <div class="ob-slider-viewport" id="ob-slider-viewport">
                    <div class="ob-slider-track" id="ob-slider-track">
                        <!-- Slide 1: Welcome -->
                        <div class="ob-slide">
                            <div class="ob-icon-circle">
                                <svg viewBox="0 0 24 24">
                                    <path
                                        d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z" />
                                </svg>
                            </div>
                            <div class="ob-title">초대와 공유</div>
                            <div class="ob-desc">여러 기기를 무선으로 연결하여<br>거대한 오디오 시스템을 만드세요.<br>6자리 숫자 코드로 연결할 수 있어요.</div>
                        </div>
                        <!-- Slide 2: Sync -->
                        <div class="ob-slide">
                            <div class="ob-icon-circle">
                                <svg viewBox="0 0 24 24">
                                    <path
                                        d="M12 3v9.28c-.47-.17-.97-.28-1.5-.28C8.01 12 6 14.01 6 16.5S8.01 21 10.5 21c2.31 0 4.16-1.75 4.45-4H15V6h4V3h-7z" />
                                </svg>
                            </div>
                            <div class="ob-title">동시에 재생</div>
                            <div class="ob-desc">호스트가 미디어를 재생하면<br>연결된 모든 기기에서 동시에 재생돼요.<br>0.01초 단위의 싱크 조절이 가능해요.</div>
                        </div>
                        <!-- Slide 3: Surround -->
                        <div class="ob-slide">
                            <div class="ob-icon-circle">
                                <svg viewBox="0 0 24 24">
                                    <path
                                        d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z" />
                                    <circle cx="12" cy="12" r="3" />
                                </svg>
                            </div>
                            <div class="ob-title">입체 음향</div>
                            <div class="ob-desc">각 기기의 역할을 설정해보세요.<br>왼쪽, 오른쪽 소리를 따로 재생하고<br>우퍼 모드로 웅장한 저음을 경험하세요.</div>
                        </div>
                    </div>
                </div>

                <div class="ob-dots" id="ob-dots">
                    <div class="ob-dot active" data-idx="0"></div>
                    <div class="ob-dot" data-idx="1"></div>
                    <div class="ob-dot" data-idx="2"></div>
                </div>

                <button class="ob-arrow ob-arrow-left" id="ob-prev" aria-label="이전 슬라이드">
                    <svg viewBox="0 0 24 24">
                        <polyline points="15 18 9 12 15 6" fill="none" stroke="currentColor"></polyline>
                    </svg>
                </button>
                <button class="ob-arrow ob-arrow-right" id="ob-next" aria-label="다음 슬라이드">
                    <svg viewBox="0 0 24 24">
                        <polyline points="9 18 15 12 9 6" fill="none" stroke="currentColor"></polyline>
                    </svg>
                </button>
            </div>

            <div class="setup-code-area" id="setup-code-area" style="display:none;">
                <div class="setup-code big-code-text" id="setup-code">------</div>
            </div>

            <div class="setup-instruction" id="setup-instruction" style="display:none;"></div>

            <div id="setup-join-area" style="display:none; width:100%;">
                <div class="setup-code-area">
                    <div class="setup-code-label">방장이 보여주는 6자리 코드를 입력해주세요</div>
                    <input type="text" class="setup-join-input" id="setup-join-code" placeholder="000000"
                        inputmode="numeric" pattern="[0-9]*" maxlength="6" autocomplete="one-time-code"
                        enterkeyhint="done" autocapitalize="off" autocorrect="off" spellcheck="false"
                        aria-label="연결 코드 6자리 입력">
                </div>
            </div>

            <!-- Guest: Role selection (4 options) -->
            <div id="setup-role-area" style="display:none; width:100%;">
                <div class="setup-role-note">
                    이 기기로 어떤 소리를 낼까요?<br><span>나중에 설정에서 변경하실 수 있어요.</span>
                </div>
                <div class="channel-grid" id="setup-role-grid" style="padding: 12px 0 0;">
                    <div class="ch-opt" data-join-ch="-1">왼쪽 소리</div>
                    <div class="ch-opt" data-join-ch="1">오른쪽 소리</div>
                    <div class="ch-opt" data-join-ch="0">원본 음원</div>
                    <div class="ch-opt" data-join-ch="2">저음 영역</div>
                </div>
            </div>

            <div class="ob-actions" id="setup-actions">
                <!-- JS will populate -->
            </div>
        </div>
    </div>


    <div id="manual-sync-overlay" class="manual-sync-overlay">
        <div class="sync-glass-panel">
            <div class="sync-header">
                <span class="sync-label">TOTAL OFFSET</span>
                <div class="sync-value-wrapper">
                    <span id="manual-sync-value" class="sync-main-val">0</span>
                    <span class="sync-unit">ms</span>
                </div>
                <div id="sync-details" class="sync-details-text"
                    style="font-size:12px; color:var(--text-sub); margin-top:-4px; margin-bottom:12px;">
                    <span style="opacity:0.7">Auto: 0ms</span> <span style="opacity:0.4">|</span> <span
                        style="opacity:0.7">Manual: 0ms</span>
                </div>
            </div>

            <!-- Main Control Row -->
            <div class="sync-control-row">
                <!-- Delay Group -->
                <div class="sync-group-side">
                    <button class="btn-nudge large" id="btn-nudge-minus10">
                        <svg viewBox="0 0 24 24">
                            <polyline points="15 18 9 12 15 6" fill="none" stroke="currentColor"></polyline>
                        </svg>
                        <span>-10</span>
                    </button>
                    <button class="btn-nudge small" id="btn-nudge-minus1">
                        <svg viewBox="0 0 24 24">
                            <polyline points="15 18 9 12 15 6" fill="none" stroke="currentColor"></polyline>
                        </svg>
                        <span>-1</span>
                    </button>
                </div>

                <div class="sync-divider"></div>

                <!-- Rush Group -->
                <div class="sync-group-side">
                    <button class="btn-nudge small" id="btn-nudge-plus1">
                        <svg viewBox="0 0 24 24">
                            <polyline points="9 18 15 12 9 6" fill="none" stroke="currentColor"></polyline>
                        </svg>
                        <span>+1</span>
                    </button>
                    <button class="btn-nudge large" id="btn-nudge-plus10">
                        <svg viewBox="0 0 24 24">
                            <polyline points="9 18 15 12 9 6" fill="none" stroke="currentColor"></polyline>
                        </svg>
                        <span>+10</span>
                    </button>
                </div>
            </div>

            <div class="sync-actions-row">
                <button class="sync-popup-reset-btn" id="btn-auto-sync">
                    AUTO
                </button>
                <button class="sync-done-btn" id="btn-sync-done">
                    DONE
                </button>
            </div>
        </div>
    </div>

    <!-- App Dialog (Non-blocking, replaces alert()) -->
    <div class="dialog-overlay" id="dialog-overlay" aria-hidden="true">
        <div class="dialog" role="dialog" aria-modal="true" aria-labelledby="dialog-title"
            aria-describedby="dialog-message">
            <div class="dialog-header">
                <span class="dialog-title" id="dialog-title">안내</span>
                <button type="button" class="dialog-close" id="btn-dialog-close" aria-label="닫기">
                    <svg viewBox="0 0 24 24" aria-hidden="true">
                        <path
                            d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
                    </svg>
                </button>
            </div>
            <div class="dialog-message" id="dialog-message"></div>
            <div class="dialog-actions">
                <button type="button" class="dialog-secondary" id="btn-dialog-secondary" style="display:none">취소</button>
                <button type="button" class="dialog-primary" id="btn-dialog-ok">확인</button>
            </div>
        </div>
    </div>

    <div class="toast" id="toast" role="status" aria-live="polite" aria-atomic="true"><span id="toast-msg">메시지</span>
    </div>

    <!-- Media Source Popup -->
    <div id="media-source-overlay" class="manual-sync-overlay">
        <div class="sync-glass-panel panel-compact">
            <div class="sync-header">
                <span class="sync-label">MEDIA SOURCE</span>
            </div>

            <div class="sync-control-row" style="flex-direction: column; height: auto; gap: 12px; padding: 12px;">
                <button class="file-select-btn file-select-btn-large" id="btn-local-file">
                    <svg viewBox="0 0 24 24" style="fill:currentColor; width:22px; height:22px;">
                        <path d="M9 16h6v-6h4l-7-7-7 7h4zm-4 2h14v2H5z" />
                    </svg>
                    <span>로컬파일 불러오기</span>
                </button>
                <button class="file-select-btn file-select-btn-large" id="btn-youtube-source">
                    <svg viewBox="0 0 24 24" style="fill:currentColor; width:22px; height:22px;">
                        <path
                            d="M10 15l5.19-3L10 9v6m11.56-7.83c.13.47.22 1.1.28 1.9.07.8.1 1.49.1 2.09L22 12c0 2.19-.16 3.8-.44 4.83-.25.9-.83 1.48-1.73 1.73-.47.13-1.33.22-2.65.28-1.3.07-2.49.1-3.59.1L12 19c-4.19 0-6.8-.16-7.83-.44-.9-.25-1.48-.83-1.73-1.73-.13-.47-.22-1.1-.28-1.9-.07-.8-.1-1.49-.1-2.09L2 12c0-2.19.16-3.8.44-4.83.25-.9.83-1.48 1.73-1.73.47-.13 1.33-.22 2.65-.28 1.3-.07 2.49-.1 3.59-.1L12 5c4.19 0 6.8.16 7.83.44.9.25 1.48.83 1.73 1.73z" />
                    </svg>
                    <span>유튜브(채널분리 미지원)</span>
                </button>

                <button class="file-select-btn file-select-btn-large" id="btn-demo-media">
                    <svg viewBox="0 0 24 24" style="fill:currentColor; width:22px; height:22px;">
                        <path
                            d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-8 12.5v-9l6 4.5-6 4.5z" />
                    </svg>
                    <span>앱 체험하기</span>
                </button>
            </div>

            <div class="sync-actions-row">
                <button class="sync-done-btn" id="btn-close-media-popup">닫기</button>
            </div>
        </div>
    </div>

    <!-- YouTube URL Popup -->
    <div id="youtube-url-overlay" class="manual-sync-overlay">
        <div class="sync-glass-panel panel-compact">
            <div class="sync-header">
                <span class="sync-label">YOUTUBE URL</span>
            </div>

            <div class="sync-control-row" style="height: auto; padding: 16px;">
                <div style="width: 100%; display: flex; flex-direction: column; gap: 12px;">
                    <input type="text" id="youtube-url-input" placeholder="https://youtube.com/watch?v=..."
                        aria-label="YouTube 링크 입력"
                        style="width:100%; padding:12px 16px; border-radius:12px; border:1px solid var(--surface-2); 
                        background:var(--surface-1); color:var(--text); font-size:14px; box-sizing:border-box; outline:none;">

                    <!-- Video Preview Container -->
                    <div id="youtube-preview"
                        style="display:none; background:var(--surface-1); border-radius:12px; padding:12px; gap:12px;">
                        <img id="youtube-preview-thumb" src="" alt="YouTube 미리보기 썸네일"
                            style="width:100%; border-radius:8px; aspect-ratio:16/9; object-fit:cover; background:#000;">
                        <div style="margin-top:8px;">
                            <p id="youtube-preview-title"
                                style="font-size:13px; font-weight:600; color:var(--text); margin:0; line-height:1.3;">
                            </p>
                            <p id="youtube-preview-channel"
                                style="font-size:11px; color:var(--text-sub); margin:4px 0 0 0;"></p>
                        </div>
                    </div>

                    <!-- Loading/Error State -->
                    <p id="youtube-preview-status"
                        style="font-size:11px; color:var(--text-sub); text-align:center; margin:0;">
                        동영상 또는 플레이리스트 링크를 입력하세요
                    </p>
                </div>
            </div>

            <div class="sync-actions-row">
                <button class="sync-popup-reset-btn" id="btn-yt-cancel">취소</button>
                <button id="youtube-play-btn" class="sync-done-btn" disabled style="opacity:0.5;">재생</button>
            </div>
        </div>
    </div>


    <script src="js/app.js" defer></script>

</body>

</html>